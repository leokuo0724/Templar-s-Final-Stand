document.write('<body style=display:flex;align-items:center;justify-content:center;background:#000;touch-action:none;margin:0><canvas height=840 id=c style=background:#ecddba width=600></canvas>');/**
 * @preserve
 * Kontra.js v10.0.0
 */
let t=()=>{};let e,i,s={};function a(t,e){s[t]=s[t]||[],s[t].push(e)}function r(t,...e){(s[t]||[]).map((t=>t(...e)))}let n={get:(e,i)=>"_proxy"==i||t};function h(){return e}function o(){return i}class c{constructor(t=0,e=0,i={}){null!=t.x?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new c(this.x+t.x,this.y+t.y,this)}}class l{constructor(t){return this.init(t)}init(t={}){this.position=function(){return new c(...arguments)}(),Object.assign(this,t)}update(t){this.advance(t)}advance(t){}_pc(){}}class d extends l{init({width:t=0,height:e=0,context:i=o(),render:s=this.draw,update:r=this.advance,children:n=[],anchor:h={x:0,y:0},opacity:c=1,rotation:l=0,scaleX:d=1,scaleY:u=1,...p}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:h,opacity:c,rotation:l,scaleX:d,scaleY:u,...p}),this._di=!0,this._uw(),this.addChild(n),this._rf=s,this._uf=r,a("init",(()=>{this.context??=o()}))}update(t){this._uf(t),this.children.map((e=>e.update&&e.update(t)))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let e=this.width,i=this.height;this.radius&&(e=i=2*this.radius);let s=-e*this.anchor.x,a=-i*this.anchor.y;(s||a)&&t.translate(s,a),this.context.globalAlpha=this.opacity,this._rf(),(s||a)&&t.translate(-s,-a),this.children.map((t=>t.render&&t.render())),t.restore()}draw(){}_pc(){this._uw(),this.children.map((t=>t._pc()))}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wrot:s=0,_wsx:a=1,_wsy:r=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=i*this.opacity,this._wsx=a*this.scaleX,this._wsy=r*this.scaleY,this._wx=this._wx*a,this._wy=this._wy*r,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=s+this.rotation;let{x:n,y:h}=function(t,e){let i=Math.sin(e),s=Math.cos(e);return{x:t.x*s-t.y*i,y:t.x*i+t.y*s}}({x:this._wx,y:this._wy},s);this._wx=n,this._wy=h,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...e){e.flat().map((e=>{this.children.push(e),e.parent=this,e._pc=e._pc||t,e._pc()}))}removeChild(...t){t.flat().map((t=>{(function(t,e){let i=t.indexOf(e);if(-1!=i)return t.splice(i,1),!0})(this.children,t)&&(t.parent=null,t._pc())}))}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=function(t,e,i){return Math.min(Math.max(t,i),e)}(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class u extends d{init({...t}={}){super.init({...t})}draw(){if(this.color){if(this.context.fillStyle=this.color,this.radius)return this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI),void this.context.fill();this.context.fillRect(0,0,this.width,this.height)}}}function p(){return new u(...arguments)}let f=/(\d+)(\w+)/;class w extends d{init({text:t="",textAlign:e="",lineHeight:i=1,font:s=o()?.font,...r}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:i,font:s,...r}),this.context&&this._p(),a("init",(()=>{this.font??=o().font,this._p()}))}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=function(t){if(!t)return{computed:0};let e=t.match(f),i=+e[1];return{size:i,unit:e[2],computed:i}}(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,e=[this.text];if(t.font=this.font,e=this.text.split("\n"),!this._s.length&&this.text.includes("\n")){let i=0;e.map((e=>{this._s.push(e),i=Math.max(i,t.measureText(e).width)})),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,i=this.context;t="right"==e?this.width:"center"==e?this.width/2|0:0,this._s.map(((s,a)=>{i.textBaseline="top",i.textAlign=e,i.fillStyle=this.color,i.font=this.font,i.fillText(s,t,this._fs*this.lineHeight*a)}))}}function y(){return new w(...arguments)}function x(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}let b={},g={},m={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"};let v={swipe:{touches:1,threshold:10,touchend({0:t}){let e=t.x-t.start.x,i=t.y-t.start.y,s=Math.abs(e),a=Math.abs(i);if(!(s<this.threshold&&a<this.threshold))return s>a?e<0?"left":"right":i<0?"up":"down"}},pinch:{touches:2,threshold:2,touchstart({0:t,1:e}){this.prevDist=Math.hypot(t.x-e.x,t.y-e.y)},touchmove({0:t,1:e}){let i=Math.hypot(t.x-e.x,t.y-e.y);if(Math.abs(i-this.prevDist)<this.threshold)return;let s=i>this.prevDist?"out":"in";return this.prevDist=i,s}}},O={},P={},T={},E={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function I(e=t,i){e._pd&&i.preventDefault(),e(i)}function k(t){let e=E[t.code],i=O[e];T[e]=!0,I(i,t)}function C(t){let e=E[t.code],i=P[e];T[e]=!1,I(i,t)}function _(){T={}}function R(t,e){return Object.values(e).includes(t)}function D(t,e,{gamepad:i,key:s}={}){[].concat(t).map((t=>{var a,r;R(t,m)?function(t,e,{gamepad:i,handler:s="gamepaddown"}={}){let a="gamepaddown"==s?b:g;[].concat(t).map((t=>{isNaN(i)?a[t]=e:(a[i]=a[i]||{},a[i][t]=e)}))}(t,e,i):(r=t,Object.keys(v).some((t=>r.startsWith(t)))||(R(t,E)?function(t,e,{handler:i="keydown",preventDefault:s=!0}={}){let a="keydown"==i?O:P;e._pd=s,[].concat(t).map((t=>a[t]=e))}(t,e,s):["down","up"].includes(t)&&((a=t)[0].toUpperCase(),a.substr(1))))}))}let A="#AD5F52",N="#913636",M="#E1C584",L="#C89660",S="#B0B17C",j="#6B7F5C",B="#A17D5E",H="#89542F",G="#692F11",Y="#64988e",W="#3d7085",$="#B4A18F",F="#796E63",X="#0F2C2E",U="#ECDDBA";function K(t,e,i,s,a){let r=e.split(" ").reduce(((t,e,i,s)=>(i%2==0&&t.push({x:parseFloat(e),y:parseFloat(s[i+1])}),t)),[]);t.beginPath(),t.moveTo(r[0].x+(s??0),r[0].y+(a??0));for(let n=1;n<r.length;n++)t.lineTo(r[n].x+(s??0),r[n].y+(a??0));t.closePath(),t.fillStyle=i,t.fill(),t.closePath()}function z(t,e,i,s,a,r,n,h){t.beginPath(),t.rect(e+0,i+0,s,a),t.fillStyle=r,t.fill(),t.closePath()}function V(t,e,i,s=0){return new Promise((a=>{let{targetX:r,targetY:n,opacity:h}=e,o=i/1e3*60,c=void 0===r?0:(r-t.x)/o,l=void 0===n?0:(n-t.y)/o,d=void 0===h?0:(h-t.opacity)/o,u=void 0===e.scale?0:(e.scale-t.scaleX)/o,p=0;!function f(){p<o?(t.x+=c,t.y+=l,t.opacity+=d,p++,t.scaleX+=u,t.scaleY+=u,setTimeout(f,i/o)):(t.x=void 0===r?t.x:r,t.y=void 0===n?t.y:n,t.opacity=void 0===h?t.opacity:h,t.scaleX=void 0===e.scale?t.scaleX:e.scale,t.scaleY=void 0===e.scale?t.scaleY:e.scale,setTimeout(a,s))}()}))}function q(t){return new Promise((e=>{setTimeout(e,t)}))}let Z="s",J="s_f",Q="i_u",tt="e_d",et="u_t_c",it="u_t_i",st="u_t_w",at="g_o",rt="t_a",nt="t_b_e";var ht;let ot;!function(t){t[t.UP=0]="UP",t[t.DOWN=1]="DOWN",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT"}(ht||(ht={}));let ct=(...t)=>lt(dt(...t)),lt=(...t)=>{ot||(ot=new AudioContext);let e=ot.createBufferSource(),i=ot.createBuffer(t.length,t[0].length,pt);return t.map(((t,e)=>i.getChannelData(e).set(t))),e.buffer=i,e.connect(ot.destination),e.start(),e},dt=(t=1,e=.05,i=220,s=0,a=0,r=.1,n=0,h=1,o=0,c=0,l=0,d=0,u=0,p=0,f=0,w=0,y=0,x=1,b=0,g=0)=>{let m,v,O=2*Math.PI,P=o*=500*O/pt**2,T=(0<f?1:-1)*O/4,E=i*=(1+2*e*Math.random()-e)*O/pt,I=[],k=0,C=0,_=0,R=1,D=0,A=0,N=0;for(c*=500*O/pt**3,f*=O/pt,l*=O/pt,d*=pt,u=pt*u|0,v=(s=99+pt*s)+(b*=pt)+(a*=pt)+(r*=pt)+(y*=pt)|0;_<v;I[_++]=N)++A%(100*w|0)||(N=n?1<n?2<n?3<n?Math.sin((k%O)**3):Math.max(Math.min(Math.tan(k),1),-1):1-(2*k/O%2+2)%2:1-4*Math.abs(Math.round(k/O)-k/O):Math.sin(k),N=(u?1-g+g*Math.sin(2*Math.PI*_/u):1)*(0<N?1:-1)*Math.abs(N)**h*t*ut*(_<s?_/s:_<s+b?1-(_-s)/b*(1-x):_<s+b+a?x:_<v-y?(v-_-y)/r*x:0),N=y?N/2+(y>_?0:(_<v-y?1:(v-_)/y)*I[_-y|0]/2):N),m=(i+=o+=c)*Math.sin(C*f-T),k+=m-m*p*(1-1e9*(Math.sin(_)+1)%2),C+=m-m*p*(1-1e9*(Math.sin(_)**2+1)%2),R&&++R>d&&(i+=l,E+=l,R=0),!u||++D%u||(i=E,o=P,R=R||1);return I},ut=.3,pt=44100,ft=[[[1.5,0,400],[1.5,0,4e3,,,.03,2,1.25,,,,,.02,6.8,-.3,,.5],[1.5,0,360,,,.12,2,2,,,,,,9,,.1]],[[[2,-1,20,,,,,,,,20,,,,,,,,],[1,1,,,20,,20,,,,,,20,,20,,,,],[,,12,,12,12,15,,15,15,8,,8,8,10,12,13,12]],[[2,-1,20,,,,,,,,20,,,,,,,,],[1,1,,,20,,20,,,,,,20,,20,,,,],[,,12,,12,12,15,,15,17,8,,8,8,10,11,13,12]],[[2,-1,20,,,,,,,,20,,,,,,,,,,],[1,1,,,20,,20,,,,,,20,,20,,,,,,],[,,12,,12,12,15,,15,15,20,,,,,,,,,,]]],[0,1,0,2],64];class wt{constructor(t){Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"startX",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"startY",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"threshold",{enumerable:!0,configurable:!0,writable:!0,value:50}),this.addEventListeners()}addEventListeners(){window.addEventListener("touchstart",this.onStart.bind(this)),window.addEventListener("touchend",this.onEnd.bind(this)),window.addEventListener("touchmove",this.preventDefault.bind(this))}onStart(t){let e=this.getPoint(t);this.startX=e.clientX,this.startY=e.clientY}onEnd(t){let e=this.getPoint(t),i=e.clientX-this.startX,s=e.clientY-this.startY;Math.abs(i)>Math.abs(s)&&Math.abs(i)>this.threshold?i>0?this.options.onSwipeRight?.():this.options.onSwipeLeft?.():Math.abs(s)>this.threshold&&(s>0?this.options.onSwipeDown?.():this.options.onSwipeUp?.())}getPoint(t){return t instanceof TouchEvent?t.changedTouches[0]:t}preventDefault(t){t.preventDefault()}}let yt=[3,,179,,.03,.06,,2.8,,,,,,.5,25,,,.46,.05],xt=t=>[.4,,t?100:50,,.3,.4,1,.1,,,t?50:20,,.09,,,,,.5,.2],bt=[3,,576,,,.007,1,.6,,,-273,,,,,,,.64],gt=[,0,350,,.3,.4,,3,,,-65,,.1,,,,,.7];var mt,vt;!function(t){t[t.PROLOGUE=0]="PROLOGUE",t[t.INIT=1]="INIT",t[t.IDLE=2]="IDLE",t[t.SWIPING=3]="SWIPING",t[t.GAME_OVER=4]="GAME_OVER"}(mt||(mt={})),function(t){t[t.KNIGHT=0]="KNIGHT",t[t.WIZARD=1]="WIZARD",t[t.DEFENDER=2]="DEFENDER"}(vt||(vt={}));class Ot{get level(){return Math.floor(this.moveCount/5)}get isWizard(){return this.cls===vt.WIZARD}get isKnight(){return this.cls===vt.KNIGHT}get isDefender(){return this.cls===vt.DEFENDER}constructor(){Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:mt.PROLOGUE}),Object.defineProperty(this,"moveCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"music",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"currentItems",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"cls",{enumerable:!0,configurable:!0,writable:!0,value:null}),new wt({onSwipeLeft:this.swipe.bind(this,ht.LEFT),onSwipeRight:this.swipe.bind(this,ht.RIGHT),onSwipeUp:this.swipe.bind(this,ht.UP),onSwipeDown:this.swipe.bind(this,ht.DOWN)}),D(["arrowleft","a"],this.swipe.bind(this,ht.LEFT)),D(["arrowright","d"],this.swipe.bind(this,ht.RIGHT)),D(["arrowup","w"],this.swipe.bind(this,ht.UP)),D(["arrowdown","s"],this.swipe.bind(this,ht.DOWN)),a(J,(()=>{this.state!==mt.GAME_OVER&&(this.state=mt.IDLE)}))}static getInstance(){return Ot.instance||(Ot.instance=new Ot),Ot.instance}setClass(t){this.cls=t,r(et,t),this.state=mt.IDLE}playBGM(){this.music=lt(...((t,e,i,s=125)=>{let a,r,n,h,o,c,l,d,u,p,f,w,y,x,b=0,g=[],m=[],v=[],O=0,P=0,T=1,E={},I=pt/s*60>>2;for(;T;O++)g=[T=d=w=0],i.map(((s,k)=>{for(l=e[s][O]||[0,0,0],T|=!!e[s][O],x=w+(e[s][0].length-2-!d)*I,y=k==i.length-1,r=2,h=w;r<l.length+y;d=++r){for(o=l[r],u=r==l.length+y-1&&y||p!=(l[0]||0)|o,n=0;n<I&&d;n++>I-99&&u?f+=(f<1)/99:0)c=(1-f)*g[b++]/2||0,m[h]=(m[h]||0)-c*P+c,v[h]=(v[h++]||0)+c*P+c;o&&(f=o%1,P=l[1]||0,(o|=0)&&(g=E[[p=l[b=0]||0,o]]=E[[p,o]]||(a=[...t[p]],a[2]*=2**((o-12)/12),o>0?dt(...a):[])))}w=x}));return[m,v]})(...ft)),this.music&&(this.music.loop=!0)}swipe(t){this.state===mt.IDLE&&(this.moveCount++,this.state=mt.SWIPING,ct(...bt),r(Z,t))}addItems(t){t.forEach((t=>{this.isDefender&&(t.duration=Math.min(6,t.duration)),this.currentItems.push(t)})),r(Q,t,[])}removeItems(t){let e=this.currentItems.filter((e=>!t.includes(e)));this.currentItems=e,r(Q,[],t)}gameOver(){this.state=mt.GAME_OVER,this.music?.stop(),ct(...gt),r(at)}}class Pt extends d{constructor(t,e,i="u"){super({x:t,y:e}),Object.defineProperty(this,"isPlaying",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.opacity=0,this.type=i}async play(){if(this.isPlaying)return;this.isPlaying=!0;let t=this.y,e=this.x;await V(this,{scale:2.5,targetX:e-14,targetY:t-6,opacity:1},200),V(this,{targetY:t+("u"===this.type?-50:50)},600),await V(this,{opacity:0},700),this.setScale(1),this.x=e,this.y=t,this.opacity=0,this.isPlaying=!1}draw(){K(this.context,"u"===this.type?"11 0 0 11 0 18 11 8 22 18 22 11 11 0":"11 18 22 7 22 0 11 10 0 0 0 7 11 18","u"===this.type?U:A)}}class Tt extends d{constructor(t,e){super({x:t,y:e}),Object.defineProperty(this,"started",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isPlaying",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.opacity=0}async loop(){for(;this.started;){if(this.isPlaying)return;this.isPlaying=!0;let t=this.y;await Promise.all([V(this,{opacity:1},200),V(this,{targetY:t+16},400)]),await V(this,{opacity:0},600),this.y=t,this.isPlaying=!1}}start(){this.started=!0,this.loop()}stop(){this.started=!1}draw(){K(this.context,"4 0 0 12 4 17 8 12 4 0",W)}}class Et extends d{constructor({x:t,y:e,condition:i}){super({x:t,y:e}),Object.defineProperty(this,"head",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frontHand",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"backHand",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"condition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isPlayingGameOver",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"upArrow",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"downArrow",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"drop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.condition=i,this.setScale("b"===i?.5:1),this.backHand=new Rt(46,60),this.head=new It(14,2),this.frontHand=new _t(4,58),this.upArrow=new Pt(24,30),this.downArrow=new Pt(24,30,"d"),this.drop=new Tt(16,0),this.addChild([this.backHand,new kt(0,32),new Ct(11,101),this.head,this.drop,this.frontHand,this.upArrow,this.downArrow]),a(rt,this.onTemplarAttack.bind(this)),a(at,this.onGameOver.bind(this)),a(nt,this.onBuffEffect.bind(this)),a(st,this.onOverweight.bind(this))}async onOverweight(t){t?this.drop.start():this.drop.stop()}async onBuffEffect(t){(t?this.upArrow:this.downArrow).play()}async onGameOver(){if(this.isPlayingGameOver)return;if(this.isPlayingGameOver=!0,"d"!==this.condition)return;let t=this.head.x,e=this.head.y;await V(this.head,{targetY:e-12},100),await q(100),await V(this.head,{targetY:e+72},250),await V(this.head,{targetX:t+3,targetY:e+46},100),await V(this.head,{targetX:t+6,targetY:e+52},200),await V(this.head,{targetX:t+9,targetY:e+72},300)}async onTemplarAttack(){if("d"===this.condition)return;let{isKnight:t,isDefender:e,isWizard:i}=Ot.getInstance();if(t){let t=this.frontHand.x,e=this.frontHand.y;await V(this.frontHand,{targetX:t+14,targetY:e-5},50),await q(200),await V(this.frontHand,{targetX:t,targetY:e},400)}let s=this.backHand.x,a=this.backHand.y;e&&(await V(this.backHand,{targetX:s+12},50),await q(200),await V(this.backHand,{targetX:s},400)),i&&(await V(this.backHand,{targetX:s+6,targetY:a-10},50),await q(200),await V(this.backHand,{targetX:s,targetY:a},400))}render(){Ot.getInstance().state===mt.GAME_OVER&&"b"===this.condition||super.render()}}class It extends d{constructor(t,e){super({x:t,y:e})}draw(){K(this.context,"39 7 31 0 7 0 0 7 0 34 13 40 36 40 39 36 39 7",$),K(this.context,"0 0 12 0 17 0 21 0 21 5 17 5 17 21 12 21 12 5 0 5 0 0",G,18,13)}}class kt extends d{constructor(t,e){super({x:t,y:e}),this.play()}async play(){for(;;)await V(this,{targetY:this.y+2},1e3),await V(this,{targetY:this.y-2},1e3)}draw(){K(this.context,"48 40 59 23 46 0 14 3 0 32 12 39 12 69 22 69 23 66 38 58 49 69 60 69 48 40",F,0,1),K(this.context,"39 47 39 12 37 0 31 0 34 12 8 12 8 0 3 0 0 61 45 61 39 47",L,11),z(this.context,12,40,38,7,"#ae5d40"),K(this.context,"11 4 7 4 7 0 4 0 4 4 0 4 0 7 4 7 4 17 7 17 7 7 11 7 11 4",N,33,16)}}class Ct extends d{constructor(t,e){super({x:t,y:e})}draw(){K(this.context,"1 12 7 12 11 0 0 0 1 12",N),K(this.context,"0 0 6 6 6 12 13 12 13 0 0 0",N,36)}}class _t extends d{constructor(t,e){super({x:t,y:e})}draw(){let{isKnight:t}=Ot.getInstance();t&&K(this.context,"66 1 50 0 0 19 1 23 3 27 54 11 66 1",U,16,-20),K(this.context,"2 2 0 10 13 12 19 7 16 0 10 0 2 2",N)}}class Rt extends d{constructor(t,e){super({x:t,y:e})}draw(){let{isDefender:t,isWizard:e}=Ot.getInstance();t&&K(this.context,"28 0 0 7 0 42 7 54 28 68 48 54 55 42 55 7 28 0",H,-14,-28),e&&(K(this.context,"3 95 0 94 25 0 32 2 3 95",B,-2,-41),K(this.context,"11 0 2 2 0 10 6 16 14 14 16 6 11 0",Y,20,-54)),K(this.context,"6 0 19 0 19 8 12 11 0 11 6 0",N)}}let Dt="Trebuchet MS",At={color:U,font:`13px ${Dt}`,anchor:{x:.5,y:.5}},Nt={color:H,font:`13px ${Dt}`},Mt=100;class Lt extends u{constructor(t,e){super({x:t,y:e,width:462,height:136,color:L});let i=y({text:"Items",x:12,y:9,...Nt});this.addChild([i]),a(Q,this.onItemsUpdated.bind(this))}async onItemsUpdated(t,e){t.length>0&&this.addChild(t),e.length>0&&this.removeChild(e);let i=Ot.getInstance();await Promise.all(i.currentItems.map((t=>t.setInactive(0)))),await Promise.all(i.currentItems.sort(((t,e)=>t.duration-e.duration)).slice(0,4).map(((t,e)=>t.setActive(60+104*e,76))))}}class St extends u{constructor({x:t,y:e,coord:i}){super({x:t,y:e,width:Mt,height:Mt,color:$,anchor:{x:.5,y:.5}}),Object.defineProperty(this,"coord",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.coord=i}}var jt,Bt;!function(t){t[t.TEMPLAR=0]="TEMPLAR",t[t.ENEMY=1]="ENEMY",t[t.WEAPON=2]="WEAPON",t[t.SHIELD=3]="SHIELD",t[t.POTION=4]="POTION"}(jt||(jt={})),function(t){t[t.PLAYER=0]="PLAYER",t[t.ENEMY=1]="ENEMY"}(Bt||(Bt={}));let Ht={[vt.KNIGHT]:{[jt.WEAPON]:3,[jt.SHIELD]:4},[vt.WIZARD]:{[jt.WEAPON]:5,[jt.SHIELD]:6},[vt.DEFENDER]:{[jt.WEAPON]:5,[jt.SHIELD]:3}};class Gt extends d{constructor(t,e,i=.5){super({x:t,y:e}),this.setScale(i)}draw(){K(this.context,"10 18 23 5 24 0 19 1 6 14 4 13 2 15 4 17 0 22 1 23 2 24 7 20 9 22 11 20 10 18",U)}}var Yt,Wt;!function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.CIRCLE=1]="CIRCLE"}(Yt||(Yt={}));class $t extends u{constructor({type:t,x:e,y:i}){super({x:e,y:i,width:Mt,height:Mt,anchor:{x:.5,y:.5}}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"main",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isActive",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mainIcon",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type=t,this.setScale(0),this.main=p({width:Mt,height:Mt,color:Ft(t,Yt.BACKGROUND),anchor:{x:.5,y:.5}}),this.addChild(this.main);let s=t===jt.TEMPLAR,a=p({radius:s?28:24,color:Ft(t,Yt.CIRCLE),anchor:{x:.5,y:.5},y:s?0:this.type===jt.ENEMY?-14:-20});this.mainIcon=this.getMainIcon(),this.main.addChild([a,this.mainIcon])}async moveTo(t,e){await V(this,{targetX:t,targetY:e},100)}async setInactive(t=200){await this.setChildrenOpacity(0,t),this.isActive=!1}async setActive(t,e){this.x=t,this.y=e,await this.setChildrenOpacity(1,200),this.isActive=!0}reset(){this.isActive=!0,this.setChildrenOpacity(1,0),this.setScale(0),this.resetProps()}async setChildrenOpacity(t,e){await Promise.all([V(this,{opacity:t},e),V(this.main,{opacity:t},e),...this.children.map((i=>V(i,{opacity:t},e))),...this.main.children.map((i=>V(i,{opacity:t},e)))])}update(){this.scaleX<=1&&(this.scaleX+=.1,this.scaleY+=.1,this.scaleX>1&&this.setScale(1))}render(){this.opacity<0||super.render()}}function Ft(t,e){switch(t){case jt.TEMPLAR:switch(e){case Yt.BACKGROUND:return L;case Yt.CIRCLE:return M}case jt.ENEMY:switch(e){case Yt.BACKGROUND:return N;case Yt.CIRCLE:return A}case jt.WEAPON:switch(e){case Yt.BACKGROUND:return W;case Yt.CIRCLE:return Y}case jt.SHIELD:switch(e){case Yt.BACKGROUND:return H;case Yt.CIRCLE:return B}case jt.POTION:switch(e){case Yt.BACKGROUND:return j;case Yt.CIRCLE:return S}}}class Xt extends d{constructor(t,e){super({x:t,y:e})}draw(){K(this.context,"20 0 13 3 7 0 0 9 13 23 26 9 20 0",G)}}class Ut extends d{constructor(t,e,i,s=H){super({x:t,y:e}),this.setScale(i??1),this.color=s}draw(){K(this.context,"10 0 0 3 0 15 2 19 10 23 17 19 19 15 19 3 10 0",this.color)}}!function(t){t.FRONT="front",t.AROUND="around",t.CROSS="cross"}(Wt||(Wt={}));let Kt={[Wt.FRONT]:2,[Wt.AROUND]:1,[Wt.CROSS]:0};var zt;function Vt(t){for(let[e,i]of Object.entries(t)){if("attackDirection"===e)return i!==Wt.FRONT;if("attackType"===e)return i!==zt.NORMAL;if("number"!=typeof i)throw new Error;return i>0}return!1}!function(t){t.NORMAL="normal",t.PENETRATE="penetrate"}(zt||(zt={}));class qt extends $t{constructor({type:t,x:e,y:i,belongs:s}){super({type:t,x:e,y:i}),Object.defineProperty(this,"damageBg",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attackText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"healthText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shieldText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"impactText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"belongs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"health",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"shield",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"attack",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"hitRate",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"critical",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"attackDirection",{enumerable:!0,configurable:!0,writable:!0,value:Wt.FRONT}),Object.defineProperty(this,"hitBack",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"attackType",{enumerable:!0,configurable:!0,writable:!0,value:zt.NORMAL}),this.belongs=s,this.color=X,this.damageBg=p({x:0,y:0,width:Mt,height:Mt,anchor:{x:.5,y:.5},color:U,opacity:0}),this.attackText=y({text:`${this.attack}`,x:42,y:39,...At}),this.healthText=y({text:`${this.health}`,x:-33,y:-34,...At}),this.shieldText=y({text:`${this.shield}`,x:37,y:-34,...At}),this.impactText=new Zt(0),this.main.addChild([this.damageBg,new Gt(20,30),this.attackText,new Xt(-46,-46),this.healthText,new Ut(28,-46),this.shieldText,this.impactText])}async execAttack(t,e,i=!1,s=!1){if(e.health<=0||this.health<=0)return;let a=this.x,n=this.y;if(await V(this.main,{targetX:-5,targetY:-10},100,700),[ht.RIGHT,ht.LEFT].includes(t)){let e=t===ht.RIGHT?-1:1;await V(this,{targetX:this.x+10*e,targetY:this.y},50),await V(this,{targetX:this.x-30*e,targetY:this.y},40)}else{let e=t===ht.DOWN?-1:1;await V(this,{targetX:this.x,targetY:this.y+10*e},50),await V(this,{targetX:this.x,targetY:this.y-30*e},40)}this.type===jt.TEMPLAR&&r(rt),ct(...yt),await V(this,{targetX:a,targetY:n},50,400);await Promise.all([V(this.main,{targetX:0,targetY:0},200),e.applyDamage(this,(()=>{switch(t){case ht.RIGHT:return ht.LEFT;case ht.LEFT:return ht.RIGHT;case ht.UP:return ht.DOWN;case ht.DOWN:return ht.UP}})(),i,s)])}async playDamage(){for(let t=0;t<2;t++)await V(this.damageBg,{opacity:.5},80),await V(this.damageBg,{opacity:0},0);this.damageBg.opacity=0}async applyDamage(t,e,i=!1,s=!1,a=0){let{attack:r,hitBack:n,hitRate:h,critical:o}=t;if(!(Math.random()<=h))return await this.impactText.show("Miss"),void(this.hitBack>0&&!i&&!a&&await this.execAttack(e,t,!0,!1));this.playDamage();let c=Math.random()<=o,l=i?n:a>0?a:r,d=c?2*l:l;c?await this.impactText.show(`Critical -${d}`):await this.impactText.show(`-${d}`);let u=s?d:this.updateShield(-d);!(await this.updateHealth(-u))&&this.hitBack>0&&!i&&!a&&await this.execAttack(e,t,!0,!1)}async applyOverweightDamage(){await Promise.all([this.impactText.show("Overweight -1"),this.updateHealth(-1)])}async updateHealth(t){if(this.health+=t,this.health<=0)return await this.setInactive(),this.deathCallback(),!0;this.healthText.text=`${this.health}`}updateShield(t){let e=0;this.shield+=t,this.shield<=0&&(e=-this.shield,this.shield=0),this.shieldText.text=`${this.shield}`;let{isDefender:i}=Ot.getInstance();return this.type===jt.TEMPLAR&&i&&(this.hitBack=this.shield,r(it,this)),e}updateAttack(t){this.attack+=t,this.attackText.text=`${this.attack}`}refreshText(){this.attackText.text=`${this.attack}`,this.healthText.text=`${this.health}`,this.shieldText.text=`${this.shield}`,this.impactText.reset()}applyBuff(t,e=!1){if(this.updateHealth(t.health||0),this.updateShield(t.shield||0),this.updateAttack(t.attack||0),this.hitRate+=t.hitRate||0,this.hitRate=Math.max(Math.min(this.hitRate,1),0),this.critical+=t.critical||0,this.critical=Math.max(Math.min(this.critical,1),0),(this.attackDirection!==Wt.CROSS||e)&&(this.attackDirection=t.attackDirection||this.attackDirection),this.attackType=t.attackType||this.attackType,this.hitBack+=t.hitBack||0,this.type===jt.TEMPLAR&&(r(it,this),!e)){let e=Vt(t);r(nt,e),e?ct(...xt(!0)):ct(...gt)}}}class Zt extends u{set text(t){this._text.text=t}constructor(t){super({x:0,y:t,width:100,height:20,color:G,anchor:{x:.5,y:.5},opacity:0}),Object.defineProperty(this,"_text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._text=y({text:"",font:`16px ${Dt}`,color:U,anchor:{x:.5,y:.5}}),this.addChild(this._text)}async show(t){this._text.text=t;let e=this.y;await Promise.all([V(this._text,{opacity:1},500),V(this,{opacity:1},500),V(this,{targetY:this.y-10},500)]),await q(100),await Promise.all([V(this._text,{opacity:0},300),V(this,{opacity:0},300)]),this.y=e}reset(){this.opacity=0,this._text.opacity=0}}function Jt(t){return t[Math.floor(Math.random()*t.length)]}class Qt extends d{constructor(t,e){super({x:t,y:e}),this.setScale(.9)}draw(){K(this.context,"10 0 0 8 0 25 5 32 6 16 2 15 3 12 8 13 8 23 10 25 11 23 11 13 16 12 17 15 13 16 14 32 19 25 19 8 10 0",U)}}let te=t=>ie(t,!1),ee=t=>ie(t,!0),ie=(t,e)=>Object.entries(t).map((([t,i])=>{if(!i)return"";if("attackDirection"===t)return`range: ${i}`;if("attackType"===t)return`${i}`;let s=["hitRate","critical"];return i>0?e?s.includes(t)?`${t} +${(100*i).toFixed()}%`:`${t} +${i}`:`high ${t}`:e?s.includes(t)?`${t} ${(100*i).toFixed()}%`:`${t} ${i}`:`low ${t}`})).join("\n");class se extends qt{constructor({x:t,y:e}){super({type:jt.ENEMY,x:t,y:e,belongs:Bt.ENEMY}),Object.defineProperty(this,"descriptionText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.descriptionText=y({x:0,y:18,text:"",...At,textAlign:"center"}),this.main.addChild(this.descriptionText),this.resetProps()}async onWizardAttack(t,e){let i=Ot.getInstance().level;await this.applyDamage(t,ht.UP,!1,t.attackType===zt.PENETRATE,e*i)}getMainIcon(){return new Qt(-8,-29)}deathCallback(){r(tt,this)}resetProps(){let{level:t,moveCount:e}=Ot.getInstance();this.health=5+2*t,this.attack=2+1*t,this.shield=0,this.hitRate=.8,this.attackDirection=Wt.FRONT,this.attackType=zt.NORMAL,this.hitBack=0;let i=e>0&&e%13==0||e>=78;this.critical=i?0:.1;let{buff:s,desc:a}=Jt(re(t+1,i));this.applyBuff(s),this.descriptionText.text=a,this.refreshText(),this.damageBg.opacity=0}}let ae=-1,re=(t,e)=>{if(e){let e=[{buff:{attackDirection:Wt.AROUND,health:2*t},desc:'"Whirlstriker"\nRange: around'},{buff:{attackDirection:Wt.CROSS,attack:2*t,health:1*t},desc:'"Spearman"\nRange: cross'},{buff:{hitBack:3*t,health:2*t},desc:'"Counterstriker"\nHit back: '+3*t},{buff:{shield:4*t},desc:'"Guardian"\nShield: '+4*t},{buff:{attackType:zt.PENETRATE,attack:2*t},desc:'"Penetrator"\nPenetrate shield'},{buff:{attackDirection:Wt.AROUND,attackType:zt.PENETRATE,shield:5*t},desc:'"Stormpiercer"\nPenetrate, around'}];return ae<e.length-1?ae++:ae=0,[e[ae]]}return[{shield:2*t,health:-2*t},{health:1*t,attack:Math.floor(-.5*t)},{critical:.05*t,health:-2*t},{attack:1*t,hitRate:-.2}].map((t=>({buff:t,desc:te(t)})))};class ne extends d{constructor(t,e){super({x:t,y:e}),this.setScale(.5)}draw(){K(this.context,"7 7 0 7 0 0 2 0 2 5 7 5 7 7",U,11,6),K(this.context,"22 3 15 0 12 0 12 2 13 2 20 5 22 10 22 14 20 19 13 22 11 22 4 19 2 14 2 10 4 5 11 2 12 2 12 0 9 0 2 3 0 8 0 16 2 21 9 24 15 24 22 21 24 16 24 8 22 3",U)}}class he extends d{constructor(t,e){super({x:t,y:e}),this.setScale(.4)}draw(){K(this.context,"24 5 20 5 20 0 12 0 12 5 8 5 0 24 32 24 24 5",U,0,4)}}class oe extends d{constructor(t,e){super({x:t,y:e})}draw(){z(this.context,6,0,6,3,U),K(this.context,"12 6 12 0 6 0 6 6 0 11 4 24 14 24 18 11 12 6",U,0,5)}}class ce extends d{constructor(t,e){super({x:t,y:e})}draw(){K(this.context,"10 0 0 17 20 17 10 0",L),z(this.context,9,6,2,6,X),z(this.context,9,13,2,2,X)}}class le extends $t{constructor({type:t,x:e,y:i,duration:s,weight:a}){super({type:t,x:e,y:i}),Object.defineProperty(this,"descriptionText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"durationText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"weightText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"buff",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"duration",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"weight",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"level",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"warningIcon",{enumerable:!0,configurable:!0,writable:!0,value:null}),this.duration=s,this.weight=a,this.buff=this.pickBuff(),this.descriptionText=y({x:0,y:18,text:ee(this.buff),...At,textAlign:"center"}),this.durationText=y({text:`${s}`,x:42,y:40,...At}),this.weightText=y({text:`${a}`,x:-24,y:40,...At}),this.main.addChild([this.descriptionText,new ne(22,32),this.durationText,new he(-46,32),this.weightText]),this.resetProps()}getMainIcon(){switch(this.type){case jt.WEAPON:return new Gt(-11,-32,1);case jt.SHIELD:return new Ut(-10,-31,1,U);case jt.POTION:return new oe(-9,-36);default:throw new Error}}async equip(){this.duration=Math.max(this.duration,2),await Promise.all([V(this.main,{targetY:-24},300,50),this.setChildrenOpacity(0,300)]),this.main.y=0}resetProps(){if(this.durationText.text=`${this.duration}`,this.weightText.text=`${this.weight}`,this.type===jt.POTION){this.warningIcon||(this.warningIcon=new ce(6,-14),this.addChild(this.warningIcon));let t=Vt(this.buff);this.warningIcon.opacity=t?0:1}}updateDuration(t){return this.duration+=t,!(this.duration<=0)&&(this.durationText.text=`${this.duration}`,!0)}upgrade(t){this.level+=t.level,this.level=Math.min(this.level,4),this.duration+=t.duration,this.weight=de(this.type,this.level),this.buff=this.pickBuff(),this.descriptionText.text=ee(this.buff),this.resetProps()}pickBuff(){let{isKnight:t,isWizard:e,isDefender:i,level:s}=Ot.getInstance(),a=s+1;switch(this.type){case jt.WEAPON:return ue(this.level,a,t);case jt.SHIELD:return pe(this.level,a,i);case jt.POTION:return fe(this.level,a,e);default:throw new Error}}}let de=(t,e)=>{if(t===jt.POTION)return 0;let{cls:i}=Ot.getInstance();return Ht[i][t]+e},ue=(t,e,i)=>{let s=i?e+2*t:1,a=Math.random();return 1===t?{attack:s}:2===t?a<.6?{attack:s,critical:.05}:{attack:s,hitRate:.05}:3===t?{attack:s,attackDirection:Wt.AROUND,hitBack:1*e}:{attack:s,attackDirection:Wt.CROSS,hitBack:3*e}},pe=(t,e,i)=>({shield:Math.floor(e/2+(i?3.5:2)*t)}),fe=(t,e,i)=>{let s=Math.random(),a=Math.ceil(t/3),r=.025+.025*t,n=i?.05:.1;return Jt([{health:e*(s>.65-n*t?a:-a)},{critical:e*s>.95-n*t?r:-r},{hitRate:e*s>.95-n*t?r:-r}])};class we extends qt{constructor({x:t,y:e}){super({type:jt.TEMPLAR,x:t,y:e,belongs:Bt.PLAYER}),Object.defineProperty(this,"weight",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"weightText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.resetProps(),this.weightText=y({text:`${this.weight}`,x:-24,y:40,...At}),this.main.addChild([new he(-46,32),this.weightText]),a(et,this.updateCls.bind(this))}getMainIcon(){return new Et({x:-18,y:-24,condition:"b"})}deathCallback(){Ot.getInstance().gameOver()}updateCls(t){this.cls=t,this.resetProps()}resetProps(){let{isDefender:t,isKnight:e,isWizard:i}=Ot.getInstance();this.health=i?6:10,this.shield=t?10:0,this.attack=e?4:1,this.hitRate=i?.65:.8,this.critical=.1,this.attackDirection=Wt.FRONT,this.attackType=zt.NORMAL,this.hitBack=t?this.shield:0,t&&this.updateWeight(3),this.refreshText(),r(it,this)}updateWeight(t){this.weight+=t,this.weightText.text=`${this.weight}`;let e=this.weight>=13;this.weightText.color=e?G:U,r(st,e)}}class ye{static createCard(t,e){let{moveCount:i,isDefender:s,isKnight:a}=Ot.getInstance();if(i%13==0)return ye.factory({type:jt.ENEMY,x:t,y:e});{let r=Math.random()>.5?jt.POTION:jt.SHIELD,n=[jt.ENEMY,s?jt.SHIELD:jt.WEAPON,r,a?jt.WEAPON:jt.POTION,s?jt.WEAPON:r];return ye.factory({type:n[i%n.length],x:t,y:e})}}static factory(t){let{type:e,x:i,y:s}=t,a=Ot.getInstance();switch(e){case jt.TEMPLAR:return new we({x:i,y:s});case jt.ENEMY:return new se({x:i,y:s});case jt.WEAPON:return new le({...t,duration:4,weight:Ht[a.cls][jt.WEAPON]});case jt.SHIELD:return new le({...t,duration:6,weight:Ht[a.cls][jt.SHIELD]});case jt.POTION:return new le({...t,duration:5,weight:0})}}}class xe extends u{constructor(t,e){let{width:i,height:s}=h();super({width:i,height:s,opacity:.8,color:X}),Object.defineProperty(this,"wrapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"titleText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"descText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.wrapper=p({x:i/2,y:s/2,width:t,height:e,anchor:{x:.5,y:.5},color:M}),this.titleText=y({text:"",x:i/2,y:s/2-52,anchor:{x:.5,y:.5},color:H,font:`24px ${Dt}`}),this.descText=y({text:"",x:i/2,y:s/2,anchor:{x:.5,y:.5},color:H,font:`16px ${Dt}`,textAlign:"center"}),this.addChild([this.wrapper,this.titleText,this.descText])}}class be extends u{constructor(t,e,i,s=!1){super({x:t,y:e,width:96,height:28,color:H,anchor:{x:.5,y:.5},opacity:s?.3:1}),Object.defineProperty(this,"isDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"canvasCallback",{enumerable:!0,configurable:!0,writable:!0,value:null}),this.isDisabled=s,this.text=y({text:i,anchor:{x:.5,y:.5},color:U,font:`16px ${Dt}`}),this.addChild(this.text)}bindClick(t){if(this.isDisabled)return;let e=h();this.canvasCallback=i=>{let{offsetLeft:s,offsetTop:a}=i.target,{world:r}=this,n=r.x-r.width/2,h=r.x+r.width/2,o=r.y-r.height/2,c=r.y+r.height/2,{width:l,height:d}=e,u=Math.min(innerWidth/l,innerHeight/d,devicePixelRatio),p=(i.x-s)/u,f=(i.y-a)/u;p>=n&&p<=h&&f>=o&&f<=c&&t()},e.addEventListener("pointerdown",this.canvasCallback)}offClick(){this.canvasCallback&&h().removeEventListener("pointerdown",this.canvasCallback)}}let ge="tfs.p",me="tfs.s";class ve extends d{constructor(t,e){super({x:t,y:e})}draw(){K(this.context,"78 0 88 47 78 50 77 78 58 76 53 109 0 82 35 9 78 0",U,17,39),K(this.context,"97 24 68 31 49 95 10 109 0 96 10 22 43 0 83 3 97 24",X,3,14),K(this.context,"93 27 89 0 76 22 54 25 38 0 38 29 19 38 0 28 10 56 98 36 93 27",L),K(this.context,"14 0 9 7 0 0 14 0",X,76,62)}}let{canvas:Oe}=function(t,{contextless:s=!1}={}){return e=document.getElementById(t)||t||document.querySelector("canvas"),s&&(e=e||new Proxy({},n)),i=e.getContext("2d")||new Proxy({},n),i.imageSmoothingEnabled=!1,r("init"),{canvas:e,context:i}}();!function(){let t;for(t=0;t<26;t++)E["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)E["Digit"+t]=E["Numpad"+t]=""+t;window.addEventListener("keydown",k),window.addEventListener("keyup",C),window.addEventListener("blur",_)}(),Ot.getInstance(),(onresize=function(){let{width:t,height:e}=Oe,i=Math.min(innerWidth/t,innerHeight/e,devicePixelRatio);Oe.style.width=Oe.width*i+"px",Oe.style.height=Oe.height*i+"px"})();let Pe=new class extends d{constructor(t,e){super({x:t,y:e}),Object.defineProperty(this,"classText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"infoText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"overweight",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"overweightText",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let i=p({x:0,y:0,color:M,width:this.context.canvas.width,height:210}),s={text:"",font:`14px ${Dt}`,color:H};this.classText=y({x:116,y:12,strokeColor:G,lineWidth:.8,...s}),this.infoText=y({x:116,y:34,...s});let r={anchor:{x:.5,y:.5},opacity:0};this.overweight=p({x:56,y:28,width:100,height:34,color:N,...r}),this.overweightText=y({...s,color:U,text:"Overweight!",...r}),this.overweight.addChild(this.overweightText),this.addChild([i,new Et({x:16,y:74,condition:"i"}),new Lt(116,54),this.classText,this.infoText,this.overweight]),a(et,this.updateClassText.bind(this)),a(it,this.updateTemplarInfo.bind(this)),a(st,this.updateOverweightText.bind(this))}updateClassText(t){switch(t){case vt.WIZARD:this.classText.text="Wizard: low attack and hit rate, equip/combine potions to attack all";break;case vt.KNIGHT:this.classText.text="Knight: everything is normal but balanced";break;case vt.DEFENDER:this.classText.text="Defender: low attack, hit back with shield"}}updateTemplarInfo(t){let e=[`Attack: ${t.attackType}, ${t.attackDirection}`,`Hit Rate: ${(100*t.hitRate).toFixed()}%`,`Critical Rate: ${(100*t.critical).toFixed()}%`,`Hit Back: ${t.hitBack}`];this.infoText.text=e.join(" | ")}updateOverweightText(t){this.overweight.opacity=t?1:0,this.overweightText.opacity=t?1:0}}(0,Oe.height-210),Te=new class extends d{constructor(t,e){super({x:t,y:e}),Object.defineProperty(this,"grids",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"occupiedInfo",{enumerable:!0,configurable:!0,writable:!0,value:Array.from({length:5},(()=>Array.from({length:5},(()=>null))))}),Object.defineProperty(this,"templarCard",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),a(Z,this.onSwipe.bind(this));let i=p({x:0,y:0,width:532,height:532,color:F});this.addChild(i);for(let a=0;a<5;a++)for(let t=0;t<5;t++){let e=new St({x:8+104*a+50,y:8+104*t+50,coord:[t,a]});this.grids.push(e),this.addChild(e)}let s=this.getGridByCoord([2,2]);this.templarCard=ye.factory({type:jt.TEMPLAR,x:s.x,y:s.y}),this.addChild(this.templarCard),this.occupiedInfo[2][2]=this.templarCard,this.spawnCards(),a(tt,this.onRemoveEnemyDead.bind(this))}getGridByCoord(t){let e=this.grids[t[0]+5*t[1]];if(!e)throw new Error;return e}onRemoveEnemyDead(t){for(let e=0;e<5;e++){let i=!1;for(let s=0;s<5;s++){if(this.occupiedInfo[s][e]===t){this.occupiedInfo[s][e]=null,i=!0;break}}if(i)break}this.removeChild(t)}async onSwipe(t){await this.checkOverweight(),await this.moveCards(t),await this.checkAttack(t),await this.checkDuration(),this.spawnCards(),r(J)}async checkOverweight(){this.templarCard.weight<13||this.templarCard.applyOverweightDamage()}async moveCards(t){let e=Ot.getInstance(),i=t===ht.RIGHT,s=t===ht.LEFT,a=t===ht.UP,n=t===ht.DOWN,h=i?3:1,o=n?3:1,c=i?-1:5,l=n?-1:5,d=i?-1:1,u=n?-1:1,p=[];for(let r=a||n?0:h;r!==c;r+=d)for(let t=s||i?0:o;t!==l;t+=u){let e=this.occupiedInfo[t][r];if(!e)continue;let h=r,o=t;for(;;){let t=h+(i?1:s?-1:0),e=o+(n?1:a?-1:0),r=this.occupiedInfo?.[e]?.[t];if(t<0||t>=5||e<0||e>=5||r)break;h=t,o=e}let c=this.getGridByCoord([o,h]);p.push({card:e,x:c.x,y:c.y}),this.occupiedInfo[t][r]=null,this.occupiedInfo[o][h]=e}await Promise.all(p.map((({card:t,x:e,y:i})=>t.moveTo(e,i))));let f=[],w=[];for(let r=a||n?0:h;r!==c;r+=d)for(let t=s||i?0:o;t!==l;t+=u){let h=this.occupiedInfo[t][r];if(!h)continue;let o=r,c=t;for(;;){let t=o+(i?1:s?-1:0),r=c+(n?1:a?-1:0);if(t<0||t>=5||r<0||r>=5)break;let l=this.occupiedInfo?.[r]?.[t];if(l){let i=h.type===jt.TEMPLAR&&l instanceof le,s=h.type===l.type&&h instanceof le,a=e.isWizard;if(i||s){i&&h.applyBuff(l.buff),s&&h.upgrade(l),s&&ct(...xt(!1)),a&&l.type===jt.POTION&&h.type===jt.POTION&&w.push(1),await l.equip(),this.occupiedInfo[r][t]=null,h instanceof we&&l.type!==jt.POTION?(h.updateWeight(l.weight),f.push(l)):(a&&h.type===jt.TEMPLAR&&w.push(l.level),await l.setInactive()),this.removeChild(l);let e=this.getGridByCoord([r,t]);await h.moveTo(e.x,e.y);continue}break}o=t,c=r}let l=this.getGridByCoord([c,o]);await h.moveTo(l.x,l.y),this.occupiedInfo[t][r]=null,h instanceof qt&&h.health<=0||(this.occupiedInfo[c][o]=h)}if(w.length){let t=this.occupiedInfo.flat().filter((t=>t instanceof se));for(let e of w)r(rt),await Promise.all(t.map((t=>t.onWizardAttack(this.templarCard,e))))}f.length&&e.addItems(f)}spawnCards(){let t=Ot.getInstance(),e=t.moveCount%5==1||t.moveCount%5==3;for(let i=0;i<(e?2:1);i++){let t=[];for(let n=0;n<5;n++)for(let e=0;e<5;e++)this.occupiedInfo[e][n]||t.push([e,n]);let e=Math.floor(Math.random()*t.length),[i,s]=t[e],a=this.getGridByCoord([i,s]),r=ye.createCard(a.x,a.y);this.addChild(r),this.occupiedInfo[i][s]=r}}async checkAttack(t){let e=[];for(let i=0;i<5;i++)for(let s=0;s<5;s++){let a=this.occupiedInfo[s][i];if(!(a instanceof qt))continue;let{attackDirection:r}=a,n=r===Wt.FRONT,h=r===Wt.AROUND,o=r===Wt.CROSS;if(n){let r=s+(t===ht.UP?-1:t===ht.DOWN?1:0),n=i+(t===ht.LEFT?-1:t===ht.RIGHT?1:0),h=this.occupiedInfo?.[r]?.[n];if(n<0||n>=5||r<0||r>=5||!h||!(h instanceof qt)||h.belongs===a.belongs)continue;e.push({attacker:a,target:h,direction:t})}else if(h){let t=[[0,1],[1,0],[0,-1],[-1,0]];for(let[r,n]of t){let t=s+r,h=i+n,o=this.occupiedInfo?.[t]?.[h];if(o instanceof qt&&o.belongs!==a.belongs){let t=0===r&&1===n?ht.RIGHT:1===r&&0===n?ht.DOWN:0===r&&-1===n?ht.LEFT:ht.UP;e.push({attacker:a,target:o,direction:t})}}}else o&&[!0,!1].forEach((t=>{let r=t?i:s,n=t?s:i;for(let i=0;i<5;i++){if(i===n)continue;let s=t?this.occupiedInfo[i][r]:this.occupiedInfo[r][i];s instanceof qt&&s.belongs!==a.belongs&&e.push({attacker:a,target:s,direction:i<n&&t?ht.UP:i<n&&!t?ht.LEFT:i>n&&t?ht.DOWN:ht.RIGHT})}}))}for(let{attacker:i,target:s,direction:a}of e)await i.execAttack(a,s,!1,i.attackType===zt.PENETRATE)}async checkDuration(){let t=Ot.getInstance(),e=[];for(let s=0;s<5;s++)for(let t=0;t<5;t++){let i=this.occupiedInfo[t][s];if(i instanceof le){i.updateDuration(-1)||(e.push(i),this.occupiedInfo[t][s]=null)}}let i=[];for(let s of t.currentItems){if(!s.updateDuration(-1)){i.push(s),e.push(s);let a={};Object.entries(s.buff).forEach((([e,i])=>{let s="attackDirection",r="attackType";if(e===s){let i=t.currentItems.filter((t=>!!t.buff[s]&&t.duration>0)).sort(((t,e)=>Kt[t.buff[s]]-Kt[e.buff[s]]))[0];a[e]=i?i.buff[s]:Wt.FRONT}else if(e===r){let i=t.currentItems.filter((t=>!!t.buff[r]&&t.duration>0))[0];a[e]=i?i.buff[r]:zt.NORMAL}else"shield"!==e&&(a[e]=-1*i)})),this.templarCard.applyBuff(a,!0),this.templarCard.updateWeight(-s.weight)}}i.length&&t.removeItems(i),await Promise.all(e.map((t=>t.setInactive())))}}((Oe.width-532)/2,76),Ee=new class extends d{constructor(){super();let{width:t,height:e}=h(),i=y({text:"MOVE 0",x:t/2,y:42,color:F,font:"36px Gill Sans",anchor:{x:.5,y:.5}}),s=p({x:t/2,y:e/2,color:G,width:600,height:100,anchor:{x:.5,y:.5},opacity:0}),r=y({text:"Powerful Enemy Coming!",color:U,font:"36px Gill Sans",anchor:{x:.5,y:.5},opacity:0});s.addChild(r),this.addChild(i,s),a(Z,(async()=>{let t=Ot.getInstance().moveCount;i.text=`MOVE ${t}`,t%13==0||t>=78&&t%5==0?(this.color=N,r.opacity=1,await V(s,{opacity:.9},500),await q(800),await V(s,{opacity:0},400),r.opacity=0):this.color=F}))}},Ie=new class extends xe{constructor(){let{width:t,height:e}=h();super(280,180),Object.defineProperty(this,"button",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.titleText.text="Game Over",this.descText.text="",this.button=new be(t/2,e/2+50,"Restart"),this.addChild([this.button,new Et({x:t/2-32,y:e/2-212,condition:"d"})]),a(at,this.show.bind(this))}show(){let t=Ot.getInstance(),e=localStorage.getItem(me);t.moveCount>parseInt(e??"0")&&(e=`${t.moveCount}`,localStorage.setItem(me,e)),this.descText.text=`Survived for ${t.moveCount} moves!\nBest Score: ${e}`,this.button.bindClick((()=>window.location.reload())),localStorage.setItem(ge,"t")}render(){Ot.getInstance().state===mt.GAME_OVER&&super.render()}},ke=new class extends xe{constructor(){super(360,180),Object.defineProperty(this,"wizardButton",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"knightButton",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"defenderButton",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t="t"===localStorage.getItem(ge);this.titleText.text="Pick a Class",this.descText.text=t?"Time to check out new classes!":"Knight is your only option for now";let{width:e,height:i}=h();this.wizardButton=new be(e/2-108,i/2+52,"Wizard",!t),this.knightButton=new be(e/2,i/2+52,"Knight"),this.defenderButton=new be(e/2+108,i/2+52,"Defender",!t),this.wizardButton.bindClick((()=>{this.onButtonClick(vt.WIZARD)})),this.knightButton.bindClick((()=>{this.onButtonClick(vt.KNIGHT)})),this.defenderButton.bindClick((()=>{this.onButtonClick(vt.DEFENDER)})),this.addChild([this.wizardButton,this.knightButton,this.defenderButton])}onButtonClick(t){let e=Ot.getInstance();e.state===mt.INIT&&(e.setClass(t),this.wizardButton.offClick(),this.knightButton.offClick(),this.defenderButton.offClick())}render(){Ot.getInstance().state===mt.INIT&&super.render()}},Ce=new class extends xe{constructor(){let t=h(),{width:e,height:i}=t;super(e,i),Object.defineProperty(this,"isClicked",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"clickCallback",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),Object.defineProperty(this,"tapCallback",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.wrapper.color=N;let s=new ve(e/2-48,i/2-220);this.addChild([s]),this.initialize()}async initialize(){let t=["It’s 1307.","As a Templar, you’ve just learned King Philip IV isn’t exactly a fan.","Now his army is after you, and survival is your only goal.","Sword ready? Good. Let’s see how long you last.","Tap to start"],e=h();this.clickCallback=this.onClick.bind(this),e.addEventListener("pointerdown",this.clickCallback);for(let i=0;i<t.length;i++){let s=i===t.length-1,a=y({...At,font:`18px ${Dt}`,text:t[i],textAlign:"center",lineHeight:1.5,x:e.width/2,y:e.height/2+i*(s?60:30),opacity:0});this.addChild(a),await q(this.isClicked?0:200),await V(a,{opacity:1},this.isClicked&&!s?0:1e3)}this.tapCallback=this.onTapStart.bind(this),e.addEventListener("pointerdown",this.tapCallback)}async onClick(){this.isClicked=!0,h().removeEventListener("pointerdown",this.clickCallback)}async onTapStart(){let t=Ot.getInstance();t.state===mt.PROLOGUE&&(t.state=mt.INIT,await Promise.all([V(this,{opacity:0},500),...this.children.map((t=>V(t,{opacity:0},500)))]),t.playBGM(),h().removeEventListener("pointerdown",this.tapCallback))}render(){let t=Ot.getInstance();t.state!==mt.PROLOGUE&&t.state!==mt.INIT||super.render()}},_e=function({fps:e=60,clearCanvas:i=!0,update:s=t,render:n,context:h=o(),blur:c=!1}={}){let l,d,u,p,f,w=0,y=1e3/e,b=1/e,g=i?x:t,m=!0;function v(){if(d=requestAnimationFrame(v),m&&(u=performance.now(),p=u-l,l=u,!(p>1e3))){for(w+=p;w>=y;)r("tick"),f.update(b),w-=y;g(f.context),f.render()}}return c||(window.addEventListener("focus",(()=>{m=!0})),window.addEventListener("blur",(()=>{m=!1}))),a("init",(()=>{f.context??=o()})),f={update:s,render:n,isStopped:!0,context:h,start(){this.isStopped&&(l=performance.now(),this.isStopped=!1,requestAnimationFrame(v))},stop(){this.isStopped=!0,cancelAnimationFrame(d)}},f}({update:()=>{Pe.update(),Te.update(),Ee.update(),Ie.update(),Ce.update(),ke.update()},render:()=>{Pe.render(),Te.render(),Ee.render(),Ie.render(),Ce.render(),ke.render()}});_e.start();
document.write('<body style=display:flex;align-items:center;justify-content:center;background:#181622;touch-action:none;margin:0><canvas height=840 id=c style=image-rendering:pixelated;background:#ecddba width=600></canvas>');/**
 * @preserve
 * Kontra.js v10.0.0
 */
let t=()=>{};let e,i,a={};function s(t,e){a[t]=a[t]||[],a[t].push(e)}function r(t,...e){(a[t]||[]).map((t=>t(...e)))}let n={get:(e,i)=>"_proxy"==i||t};function h(){return e}function o(){return i}class c{constructor(t=0,e=0,i={}){null!=t.x?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new c(this.x+t.x,this.y+t.y,this)}}class l{constructor(t){return this.init(t)}init(t={}){this.position=function(){return new c(...arguments)}(),Object.assign(this,t)}update(t){this.advance(t)}advance(t){}_pc(){}}class d extends l{init({width:t=0,height:e=0,context:i=o(),render:a=this.draw,update:r=this.advance,children:n=[],anchor:h={x:0,y:0},opacity:c=1,rotation:l=0,scaleX:d=1,scaleY:u=1,...p}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:h,opacity:c,rotation:l,scaleX:d,scaleY:u,...p}),this._di=!0,this._uw(),this.addChild(n),this._rf=a,this._uf=r,s("init",(()=>{this.context??=o()}))}update(t){this._uf(t),this.children.map((e=>e.update&&e.update(t)))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let e=this.width,i=this.height;this.radius&&(e=i=2*this.radius);let a=-e*this.anchor.x,s=-i*this.anchor.y;(a||s)&&t.translate(a,s),this.context.globalAlpha=this.opacity,this._rf(),(a||s)&&t.translate(-a,-s),this.children.map((t=>t.render&&t.render())),t.restore()}draw(){}_pc(){this._uw(),this.children.map((t=>t._pc()))}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wrot:a=0,_wsx:s=1,_wsy:r=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=i*this.opacity,this._wsx=s*this.scaleX,this._wsy=r*this.scaleY,this._wx=this._wx*s,this._wy=this._wy*r,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=a+this.rotation;let{x:n,y:h}=function(t,e){let i=Math.sin(e),a=Math.cos(e);return{x:t.x*a-t.y*i,y:t.x*i+t.y*a}}({x:this._wx,y:this._wy},a);this._wx=n,this._wy=h,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...e){e.flat().map((e=>{this.children.push(e),e.parent=this,e._pc=e._pc||t,e._pc()}))}removeChild(...t){t.flat().map((t=>{(function(t,e){let i=t.indexOf(e);if(-1!=i)return t.splice(i,1),!0})(this.children,t)&&(t.parent=null,t._pc())}))}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=function(t,e,i){return Math.min(Math.max(t,i),e)}(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class u extends d{init({...t}={}){super.init({...t})}draw(){if(this.color){if(this.context.fillStyle=this.color,this.radius)return this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI),void this.context.fill();this.context.fillRect(0,0,this.width,this.height)}}}function p(){return new u(...arguments)}let f=/(\d+)(\w+)/;class w extends d{init({text:t="",textAlign:e="",lineHeight:i=1,font:a=o()?.font,...r}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:i,font:a,...r}),this.context&&this._p(),s("init",(()=>{this.font??=o().font,this._p()}))}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=function(t){if(!t)return{computed:0};let e=t.match(f),i=+e[1];return{size:i,unit:e[2],computed:i}}(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,e=[this.text];if(t.font=this.font,e=this.text.split("\n"),!this._s.length&&this.text.includes("\n")){let i=0;e.map((e=>{this._s.push(e),i=Math.max(i,t.measureText(e).width)})),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,i=this.context;t="right"==e?this.width:"center"==e?this.width/2|0:0,this._s.map(((a,s)=>{i.textBaseline="top",i.textAlign=e,i.fillStyle=this.color,i.font=this.font,i.fillText(a,t,this._fs*this.lineHeight*s)}))}}function x(){return new w(...arguments)}function y(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}let g={},b={},m={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"};let v={swipe:{touches:1,threshold:10,touchend({0:t}){let e=t.x-t.start.x,i=t.y-t.start.y,a=Math.abs(e),s=Math.abs(i);if(!(a<this.threshold&&s<this.threshold))return a>s?e<0?"left":"right":i<0?"up":"down"}},pinch:{touches:2,threshold:2,touchstart({0:t,1:e}){this.prevDist=Math.hypot(t.x-e.x,t.y-e.y)},touchmove({0:t,1:e}){let i=Math.hypot(t.x-e.x,t.y-e.y);if(Math.abs(i-this.prevDist)<this.threshold)return;let a=i>this.prevDist?"out":"in";return this.prevDist=i,a}}},T={},E={},P={},O={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function I(e=t,i){e._pd&&i.preventDefault(),e(i)}function k(t){let e=O[t.code],i=T[e];P[e]=!0,I(i,t)}function _(t){let e=O[t.code],i=E[e];P[e]=!1,I(i,t)}function C(){P={}}function R(t,e){return Object.values(e).includes(t)}function A(t,e,{gamepad:i,key:a}={}){[].concat(t).map((t=>{var s,r;R(t,m)?function(t,e,{gamepad:i,handler:a="gamepaddown"}={}){let s="gamepaddown"==a?g:b;[].concat(t).map((t=>{isNaN(i)?s[t]=e:(s[i]=s[i]||{},s[i][t]=e)}))}(t,e,i):(r=t,Object.keys(v).some((t=>r.startsWith(t)))||(R(t,O)?function(t,e,{handler:i="keydown",preventDefault:a=!0}={}){let s="keydown"==i?T:E;e._pd=a,[].concat(t).map((t=>s[t]=e))}(t,e,a):["down","up"].includes(t)&&((s=t)[0].toUpperCase(),s.substr(1))))}))}let D="#AD5F52",N="#913636",M="#E1C584",L="#C89660",j="#B0B17C",S="#6B7F5C",Y="#A17D5E",H="#89542F",B="#692F11",G="#64988e",W="#3d7085",$="#B4A18F",X="#796E63",F="#0F2C2E",U="#ECDDBA";function K(t,e,i,a,s){let r=e.split(" ").reduce(((t,e,i,a)=>(i%2==0&&t.push({x:parseFloat(e),y:parseFloat(a[i+1])}),t)),[]);t.beginPath(),t.moveTo(r[0].x+(a??0),r[0].y+(s??0));for(let n=1;n<r.length;n++)t.lineTo(r[n].x+(a??0),r[n].y+(s??0));t.closePath(),t.fillStyle=i,t.fill(),t.closePath()}function z(t,e,i,a,s,r,n,h){t.beginPath(),t.rect(e+0,i+0,a,s),t.fillStyle=r,t.fill(),t.closePath()}function V(t,e,i,a=0){return new Promise((s=>{let{targetX:r,targetY:n,opacity:h}=e,o=i/1e3*60,c=void 0===r?0:(r-t.x)/o,l=void 0===n?0:(n-t.y)/o,d=void 0===h?0:(h-t.opacity)/o,u=void 0===e.scale?0:(e.scale-t.scaleX)/o,p=0;!function f(){p<o?(t.x+=c,t.y+=l,t.opacity+=d,p++,t.scaleX+=u,t.scaleY+=u,setTimeout(f,i/o)):(t.x=void 0===r?t.x:r,t.y=void 0===n?t.y:n,t.opacity=void 0===h?t.opacity:h,t.scaleX=void 0===e.scale?t.scaleX:e.scale,t.scaleY=void 0===e.scale?t.scaleY:e.scale,setTimeout(s,a))}()}))}function q(t){return new Promise((e=>{setTimeout(e,t)}))}let Z="s",J="s_f",Q="i_u",tt="e_d",et="r_e_d",it="u_t_c",at="u_t_i",st="u_t_w",rt="g_o",nt="t_a",ht="t_b_e";var ot;!function(t){t[t.UP=0]="UP",t[t.DOWN=1]="DOWN",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT"}(ot||(ot={}));let ct=(...t)=>lt(dt(...t)),lt=(...t)=>{let e=ft.createBufferSource(),i=ft.createBuffer(t.length,t[0].length,pt);return t.map(((t,e)=>i.getChannelData(e).set(t))),e.buffer=i,e.connect(ft.destination),e.start(),e},dt=(t=1,e=.05,i=220,a=0,s=0,r=.1,n=0,h=1,o=0,c=0,l=0,d=0,u=0,p=0,f=0,w=0,x=0,y=1,g=0,b=0)=>{let m,v,T=2*Math.PI,E=o*=500*T/pt**2,P=(0<f?1:-1)*T/4,O=i*=(1+2*e*Math.random()-e)*T/pt,I=[],k=0,_=0,C=0,R=1,A=0,D=0,N=0;for(c*=500*T/pt**3,f*=T/pt,l*=T/pt,d*=pt,u=pt*u|0,v=(a=99+pt*a)+(g*=pt)+(s*=pt)+(r*=pt)+(x*=pt)|0;C<v;I[C++]=N)++D%(100*w|0)||(N=n?1<n?2<n?3<n?Math.sin((k%T)**3):Math.max(Math.min(Math.tan(k),1),-1):1-(2*k/T%2+2)%2:1-4*Math.abs(Math.round(k/T)-k/T):Math.sin(k),N=(u?1-b+b*Math.sin(2*Math.PI*C/u):1)*(0<N?1:-1)*Math.abs(N)**h*t*ut*(C<a?C/a:C<a+g?1-(C-a)/g*(1-y):C<a+g+s?y:C<v-x?(v-C-x)/r*y:0),N=x?N/2+(x>C?0:(C<v-x?1:(v-C)/x)*I[C-x|0]/2):N),m=(i+=o+=c)*Math.sin(_*f-P),k+=m-m*p*(1-1e9*(Math.sin(C)+1)%2),_+=m-m*p*(1-1e9*(Math.sin(C)**2+1)%2),R&&++R>d&&(i+=l,O+=l,R=0),!u||++A%u||(i=O,o=E,R=R||1);return I},ut=.3,pt=44100,ft=new(window.AudioContext||window.webkitAudioContext),wt=[[[1,0,400],[1,0,4e3,,,.03,2,1.25,,,,,.02,6.8,-.3,,.5],[1,0,360,,,.12,2,2,,,,,,9,,.1]],[[[2,-1,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,],[1,1,,,,,,20,,20,,,,,,20,,20,,,,,,20,,20,,,,,,20,,20,,,,,,20,,20,,,,,,20,,20,,,,,,20,,20,,,,,,20,,20,,,],[,,,,,12,,12,12,15,,15,15,8,,8,8,10,12,13,12,12,,12,12,15,,15,17,8,,8,8,10,11,13,12,12,,12,12,15,,15,15,8,,8,8,10,12,13,12,12,,12,12,15,,15,15,20,,,,,,,]]],[0],84];class xt{constructor(t){Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"startX",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"startY",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"threshold",{enumerable:!0,configurable:!0,writable:!0,value:50}),this.addEventListeners()}addEventListeners(){window.addEventListener("touchstart",this.onStart.bind(this)),window.addEventListener("touchend",this.onEnd.bind(this)),window.addEventListener("touchmove",this.preventDefault.bind(this))}onStart(t){let e=this.getPoint(t);this.startX=e.clientX,this.startY=e.clientY}onEnd(t){let e=this.getPoint(t),i=e.clientX-this.startX,a=e.clientY-this.startY;Math.abs(i)>Math.abs(a)&&Math.abs(i)>this.threshold?i>0?this.options.onSwipeRight?.():this.options.onSwipeLeft?.():Math.abs(a)>this.threshold&&(a>0?this.options.onSwipeDown?.():this.options.onSwipeUp?.())}getPoint(t){return t instanceof TouchEvent?t.changedTouches[0]:t}preventDefault(t){t.preventDefault()}}let yt=[3,,179,,.03,.06,,2.8,,,,,,.5,25,,,.46,.05],gt=t=>[.4,,t?100:50,,.3,.4,1,.1,,,t?50:20,,.09,,,,,.5,.2],bt=[3,,576,,,.007,1,.6,,,-273,,,,,,,.64],mt=[,0,350,,.3,.4,,3,,,-65,,.1,,,,,.7];var vt,Tt;!function(t){t[t.INIT=0]="INIT",t[t.IDLE=1]="IDLE",t[t.SWIPING=2]="SWIPING",t[t.GAME_OVER=3]="GAME_OVER"}(vt||(vt={})),function(t){t[t.KNIGHT=0]="KNIGHT",t[t.WIZARD=1]="WIZARD",t[t.DEFENDER=2]="DEFENDER"}(Tt||(Tt={}));class Et{get level(){return Math.floor(this.moveCount/5)}get isWizard(){return this.cls===Tt.WIZARD}get isKnight(){return this.cls===Tt.KNIGHT}get isDefender(){return this.cls===Tt.DEFENDER}constructor(){Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:vt.INIT}),Object.defineProperty(this,"moveCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"music",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"currentItems",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"reusableEnemyCards",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"cls",{enumerable:!0,configurable:!0,writable:!0,value:null}),new xt({onSwipeLeft:this.swipe.bind(this,ot.LEFT),onSwipeRight:this.swipe.bind(this,ot.RIGHT),onSwipeUp:this.swipe.bind(this,ot.UP),onSwipeDown:this.swipe.bind(this,ot.DOWN)}),A(["arrowleft","a"],this.swipe.bind(this,ot.LEFT)),A(["arrowright","d"],this.swipe.bind(this,ot.RIGHT)),A(["arrowup","w"],this.swipe.bind(this,ot.UP)),A(["arrowdown","s"],this.swipe.bind(this,ot.DOWN)),s(J,(()=>{this.state!==vt.GAME_OVER&&(this.state=vt.IDLE)})),s(tt,this.onEnemyDead.bind(this))}static getInstance(){return Et.instance||(Et.instance=new Et),Et.instance}setClass(t){this.cls=t,this.playBGM(),r(it,t),this.state=vt.IDLE}playBGM(){this.music=lt(...((t,e,i,a=125)=>{let s,r,n,h,o,c,l,d,u,p,f,w,x,y,g=0,b=[],m=[],v=[],T=0,E=0,P=1,O={},I=pt/a*60>>2;for(;P;T++)b=[P=d=w=0],i.map(((a,k)=>{for(l=e[a][T]||[0,0,0],P|=!!e[a][T],y=w+(e[a][0].length-2-!d)*I,x=k==i.length-1,r=2,h=w;r<l.length+x;d=++r){for(o=l[r],u=r==l.length+x-1&&x||p!=(l[0]||0)|o,n=0;n<I&&d;n++>I-99&&u?f+=(f<1)/99:0)c=(1-f)*b[g++]/2||0,m[h]=(m[h]||0)-c*E+c,v[h]=(v[h++]||0)+c*E+c;o&&(f=o%1,E=l[1]||0,(o|=0)&&(b=O[[p=l[g=0]||0,o]]=O[[p,o]]||(s=[...t[p]],s[2]*=2**((o-12)/12),o>0?dt(...s):[])))}w=y}));return[m,v]})(...wt)),this.music.loop=!0}swipe(t){this.state===vt.IDLE&&(this.moveCount++,this.state=vt.SWIPING,ct(...bt),r(Z,t))}addItems(t){t.forEach((t=>{this.isDefender&&(t.duration=Math.min(6,t.duration)),this.currentItems.push(t)})),r(Q,t,[])}removeItems(t){let e=this.currentItems.filter((e=>!t.includes(e)));this.currentItems=e,r(Q,[],t)}onEnemyDead(t){this.reusableEnemyCards.push(t),r(et,t)}gameOver(){this.state=vt.GAME_OVER,this.music?.stop(),ct(...mt),r(rt)}}class Pt extends d{constructor(t,e,i="u"){super({x:t,y:e}),Object.defineProperty(this,"isPlaying",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.opacity=0,this.type=i}async play(){if(this.isPlaying)return;this.isPlaying=!0;let t=this.y,e=this.x;await V(this,{scale:2.5,targetX:e-14,targetY:t-6,opacity:1},200),V(this,{targetY:t+("u"===this.type?-50:50)},600),await V(this,{opacity:0},700),this.setScale(1),this.x=e,this.y=t,this.opacity=0,this.isPlaying=!1}draw(){K(this.context,"u"===this.type?"11 0 0 11 0 18 11 8 22 18 22 11 11 0":"11 18 22 7 22 0 11 10 0 0 0 7 11 18","u"===this.type?U:D)}}class Ot extends d{constructor({x:t,y:e,condition:i}){super({x:t,y:e}),Object.defineProperty(this,"head",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frontHand",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"backHand",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"condition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isPlayingGameOver",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"upArrow",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"downArrow",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.condition=i,this.setScale("b"===i?.5:1),this.backHand=new Rt(46,60),this.head=new It(14,2),this.frontHand=new Ct(4,58),this.upArrow=new Pt(24,30),this.downArrow=new Pt(24,30,"d"),this.addChild([this.backHand,new kt(0,32),new _t(11,101),this.head,this.frontHand,this.upArrow,this.downArrow]),s(nt,this.onTemplarAttack.bind(this)),s(rt,this.onGameOver.bind(this)),s(ht,this.onBuffEffect.bind(this))}async onBuffEffect(t){(t?this.upArrow:this.downArrow).play()}async onGameOver(){if(this.isPlayingGameOver)return;if(this.isPlayingGameOver=!0,"d"!==this.condition)return;let t=this.head.x,e=this.head.y;await V(this.head,{targetY:e-12},100),await q(100),await V(this.head,{targetY:e+72},250),await V(this.head,{targetX:t+3,targetY:e+46},100),await V(this.head,{targetX:t+6,targetY:e+52},200),await V(this.head,{targetX:t+9,targetY:e+72},300)}async onTemplarAttack(){if("d"===this.condition)return;let{isKnight:t,isDefender:e,isWizard:i}=Et.getInstance();if(t){let t=this.frontHand.x,e=this.frontHand.y;await V(this.frontHand,{targetX:t+14,targetY:e-5},50),await q(200),await V(this.frontHand,{targetX:t,targetY:e},400)}let a=this.backHand.x,s=this.backHand.y;e&&(await V(this.backHand,{targetX:a+12},50),await q(200),await V(this.backHand,{targetX:a},400)),i&&(await V(this.backHand,{targetX:a+6,targetY:s-10},50),await q(200),await V(this.backHand,{targetX:a,targetY:s},400))}render(){Et.getInstance().state===vt.GAME_OVER&&"b"===this.condition||super.render()}}class It extends d{constructor(t,e){super({x:t,y:e})}draw(){K(this.context,"39 7 31 0 7 0 0 7 0 34 13 40 36 40 39 36 39 7",$),K(this.context,"0 0 12 0 17 0 21 0 21 5 17 5 17 21 12 21 12 5 0 5 0 0",B,18,13)}}class kt extends d{constructor(t,e){super({x:t,y:e}),this.play()}async play(){for(;;)await V(this,{targetY:this.y+2},1e3),await V(this,{targetY:this.y-2},1e3)}draw(){K(this.context,"48 40 59 23 46 0 14 3 0 32 12 39 12 69 22 69 23 66 38 58 49 69 60 69 48 40",X,0,1),K(this.context,"39 47 39 12 37 0 31 0 34 12 8 12 8 0 3 0 0 61 45 61 39 47",L,11),z(this.context,12,40,38,7,"#ae5d40"),K(this.context,"11 4 7 4 7 0 4 0 4 4 0 4 0 7 4 7 4 17 7 17 7 7 11 7 11 4",N,33,16)}}class _t extends d{constructor(t,e){super({x:t,y:e})}draw(){K(this.context,"1 12 7 12 11 0 0 0 1 12",N),K(this.context,"0 0 6 6 6 12 13 12 13 0 0 0",N,36)}}class Ct extends d{constructor(t,e){super({x:t,y:e})}draw(){let{isKnight:t}=Et.getInstance();t&&K(this.context,"66 1 50 0 0 19 1 23 3 27 54 11 66 1",U,16,-20),K(this.context,"2 2 0 10 13 12 19 7 16 0 10 0 2 2",N)}}class Rt extends d{constructor(t,e){super({x:t,y:e})}draw(){let{isDefender:t,isWizard:e}=Et.getInstance();t&&K(this.context,"28 0 0 7 0 42 7 54 28 68 48 54 55 42 55 7 28 0",H,-14,-28),e&&(K(this.context,"3 95 0 94 25 0 32 2 3 95",Y,-2,-41),K(this.context,"11 0 2 2 0 10 6 16 14 14 16 6 11 0",G,20,-54)),K(this.context,"6 0 19 0 19 8 12 11 0 11 6 0",N)}}let At="Trebuchet MS",Dt={color:U,font:`12px ${At}`,anchor:{x:.5,y:.5}},Nt={color:H,font:`12px ${At}`},Mt=100;class Lt extends u{constructor(t,e){super({x:t,y:e,width:462,height:136,color:L});let i=x({text:"Items",x:12,y:9,...Nt});this.addChild([i]),s(Q,this.onItemsUpdated.bind(this))}async onItemsUpdated(t,e){t.length>0&&this.addChild(t),e.length>0&&this.removeChild(e);let i=Et.getInstance();await Promise.all(i.currentItems.map((t=>t.setInactive(0)))),await Promise.all(i.currentItems.sort(((t,e)=>t.duration-e.duration)).slice(0,4).map(((t,e)=>t.setActive(60+104*e,76))))}}class jt extends u{constructor({x:t,y:e,coord:i}){super({x:t,y:e,width:Mt,height:Mt,color:$,anchor:{x:.5,y:.5}}),Object.defineProperty(this,"coord",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.coord=i}}var St,Yt,Ht,Bt,Gt;!function(t){t[t.TEMPLAR=0]="TEMPLAR",t[t.ENEMY=1]="ENEMY",t[t.WEAPON=2]="WEAPON",t[t.SHIELD=3]="SHIELD",t[t.POTION=4]="POTION"}(St||(St={})),function(t){t[t.PLAYER=0]="PLAYER",t[t.ENEMY=1]="ENEMY"}(Yt||(Yt={}));class Wt extends d{constructor(t,e,i=.5){super({x:t,y:e}),this.setScale(i)}draw(){K(this.context,"10 18 23 5 24 0 19 1 6 14 4 13 2 15 4 17 0 22 1 23 2 24 7 20 9 22 11 20 10 18",U)}}!function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.CIRCLE=1]="CIRCLE"}(Ht||(Ht={}));class $t extends u{constructor({type:t,x:e,y:i}){super({x:e,y:i,width:Mt,height:Mt,anchor:{x:.5,y:.5}}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"main",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isActive",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mainIcon",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type=t,this.setScale(0),this.main=p({width:Mt,height:Mt,color:Xt(t,Ht.BACKGROUND),anchor:{x:.5,y:.5}}),this.addChild(this.main);let a=t===St.TEMPLAR,s=p({radius:a?28:24,color:Xt(t,Ht.CIRCLE),anchor:{x:.5,y:.5},y:a?0:this.type===St.ENEMY?-14:-20});this.mainIcon=this.getMainIcon(),this.main.addChild([s,this.mainIcon])}async moveTo(t,e){await V(this,{targetX:t,targetY:e},100)}async setInactive(t=200){await this.setChildrenOpacity(0,t),this.isActive=!1}async setActive(t,e){this.x=t,this.y=e,await this.setChildrenOpacity(1,200),this.isActive=!0}reset(){this.isActive=!0,this.setChildrenOpacity(1,0),this.setScale(0),this.resetProps()}async setChildrenOpacity(t,e){await Promise.all([V(this,{opacity:t},e),V(this.main,{opacity:t},e),...this.children.map((i=>V(i,{opacity:t},e))),...this.main.children.map((i=>V(i,{opacity:t},e)))])}update(){this.scaleX<=1&&(this.scaleX+=.1,this.scaleY+=.1,this.scaleX>1&&this.setScale(1))}render(){this.opacity<0||super.render()}}function Xt(t,e){switch(t){case St.TEMPLAR:switch(e){case Ht.BACKGROUND:return L;case Ht.CIRCLE:return M}case St.ENEMY:switch(e){case Ht.BACKGROUND:return N;case Ht.CIRCLE:return D}case St.WEAPON:switch(e){case Ht.BACKGROUND:return W;case Ht.CIRCLE:return G}case St.SHIELD:switch(e){case Ht.BACKGROUND:return H;case Ht.CIRCLE:return Y}case St.POTION:switch(e){case Ht.BACKGROUND:return S;case Ht.CIRCLE:return j}}}class Ft extends d{constructor(t,e){super({x:t,y:e})}draw(){K(this.context,"20 0 13 3 7 0 0 9 13 23 26 9 20 0",B)}}class Ut extends d{constructor(t,e,i,a=H){super({x:t,y:e}),this.setScale(i??1),this.color=a}draw(){K(this.context,"10 0 0 3 0 15 2 19 10 23 17 19 19 15 19 3 10 0",this.color)}}!function(t){t.FRONT="front",t.LINE="line",t.AROUND="around"}(Bt||(Bt={})),function(t){t.NORMAL="normal",t.PENETRATE="penetrate"}(Gt||(Gt={}));class Kt extends $t{constructor({type:t,x:e,y:i,belongs:a}){super({type:t,x:e,y:i}),Object.defineProperty(this,"damageBg",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attackText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"healthText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shieldText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"impactText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"belongs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"health",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"shield",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"attack",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"hitRate",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"criticalRate",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"attackDirection",{enumerable:!0,configurable:!0,writable:!0,value:Bt.FRONT}),Object.defineProperty(this,"hitBackAttack",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"attackType",{enumerable:!0,configurable:!0,writable:!0,value:Gt.NORMAL}),this.belongs=a,this.color=F,this.damageBg=p({x:0,y:0,width:Mt,height:Mt,anchor:{x:.5,y:.5},color:U,opacity:0}),this.attackText=x({text:`${this.attack}`,x:42,y:39,...Dt}),this.healthText=x({text:`${this.health}`,x:-33,y:-34,...Dt}),this.shieldText=x({text:`${this.shield}`,x:37,y:-34,...Dt}),this.impactText=new zt(0),this.main.addChild([this.damageBg,new Wt(20,30),this.attackText,new Ft(-46,-46),this.healthText,new Ut(28,-46),this.shieldText,this.impactText])}async execAttack(t,e,i=!1,a=!1){if(e.health<=0||this.health<=0)return;let s=this.x,n=this.y;if(await V(this.main,{targetX:-5,targetY:-10},100,700),[ot.RIGHT,ot.LEFT].includes(t)){let e=t===ot.RIGHT?-1:1;await V(this,{targetX:this.x+10*e,targetY:this.y},50),await V(this,{targetX:this.x-30*e,targetY:this.y},40)}else{let e=t===ot.DOWN?-1:1;await V(this,{targetX:this.x,targetY:this.y+10*e},50),await V(this,{targetX:this.x,targetY:this.y-30*e},40)}this.type===St.TEMPLAR&&r(nt),ct(...yt),await V(this,{targetX:s,targetY:n},50,400);await Promise.all([V(this.main,{targetX:0,targetY:0},200),e.applyDamage(this,(()=>{switch(t){case ot.RIGHT:return ot.LEFT;case ot.LEFT:return ot.RIGHT;case ot.UP:return ot.DOWN;case ot.DOWN:return ot.UP}})(),i,a)])}async playDamage(){for(let t=0;t<2;t++)await V(this.damageBg,{opacity:.5},80),await V(this.damageBg,{opacity:0},0);this.damageBg.opacity=0}async applyDamage(t,e,i=!1,a=!1,s=0){let{attack:r,hitBackAttack:n,hitRate:h,criticalRate:o}=t;if(!(Math.random()<=h))return await this.impactText.show("Miss"),void(this.hitBackAttack>0&&!i&&!s&&await this.execAttack(e,t,!0,!1));this.playDamage();let c=Math.random()<=o,l=i?n:s>0?s:r,d=c?2*l:l;c?await this.impactText.show(`Critical -${d}`):await this.impactText.show(`-${d}`);let u=a?d:this.updateShield(-d);!(await this.updateHealth(-u))&&this.hitBackAttack>0&&!i&&!s&&await this.execAttack(e,t,!0,!1)}async applyOverweightDamage(){await Promise.all([this.impactText.show("Overweight -1"),this.updateHealth(-1)])}async updateHealth(t){if(this.health+=t,this.health<=0)return await this.setInactive(),this.deathCallback(),!0;this.healthText.text=`${this.health}`}updateShield(t){let e=0;this.shield+=t,this.shield<=0&&(e=-this.shield,this.shield=0),this.shieldText.text=`${this.shield}`;let{isDefender:i}=Et.getInstance();return this.type===St.TEMPLAR&&i&&(this.hitBackAttack=this.shield,r(at,this)),e}updateAttack(t){this.attack+=t,this.attackText.text=`${this.attack}`}refreshText(){this.attackText.text=`${this.attack}`,this.healthText.text=`${this.health}`,this.shieldText.text=`${this.shield}`,this.impactText.reset()}applyBuff(t,e=!0){if(this.updateHealth(t.health||0),this.updateShield(t.shield||0),this.updateAttack(t.attack||0),this.hitRate+=t.hitRate||0,this.hitRate=Math.max(Math.min(this.hitRate,1),0),this.criticalRate+=t.criticalRate||0,this.criticalRate=Math.max(Math.min(this.criticalRate,1),0),this.attackDirection=t.attackDirection||this.attackDirection,this.attackType=t.attackType||this.attackType,this.hitBackAttack+=t.hitBackAttack||0,this.type===St.TEMPLAR&&(r(at,this),e)){let e=function(t){for(let[e,i]of Object.entries(t)){if("attackDirection"===e)return i!==Bt.FRONT;if("attackType"===e)return i!==Gt.NORMAL;if("number"!=typeof i)throw new Error("Invalid buff");return i>0}return!1}(t);r(ht,e),e?ct(...gt(!0)):ct(...mt)}}}class zt extends u{set text(t){this._text.text=t}constructor(t){super({x:0,y:t,width:100,height:20,color:B,anchor:{x:.5,y:.5},opacity:0}),Object.defineProperty(this,"_text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._text=x({text:"",font:`16px ${At}`,color:U,anchor:{x:.5,y:.5}}),this.addChild(this._text)}async show(t){this._text.text=t;let e=this.y;await Promise.all([V(this._text,{opacity:1},500),V(this,{opacity:1},500),V(this,{targetY:this.y-10},500)]),await q(100),await Promise.all([V(this._text,{opacity:0},300),V(this,{opacity:0},300)]),this.y=e}reset(){this.opacity=0,this._text.opacity=0}}function Vt(t){return t[Math.floor(Math.random()*t.length)]}class qt extends d{constructor(t,e){super({x:t,y:e}),this.setScale(.9)}draw(){K(this.context,"10 0 0 8 0 25 5 32 6 16 2 15 3 12 8 13 8 23 10 25 11 23 11 13 16 12 17 15 13 16 14 32 19 25 19 8 10 0",U)}}let Zt=t=>Qt(t,!1),Jt=t=>Qt(t,!0),Qt=(t,e)=>Object.entries(t).map((([t,i])=>{if(!i)return"";if("attackDirection"===t)return`range: ${i}`;if("attackType"===t)return`type: ${i}`;let a=["hitRate","criticalRate"];return i>0?e?a.includes(t)?`${t} +${(100*i).toFixed()}%`:`${t} +${i}`:`high ${t}`:e?a.includes(t)?`${t} ${(100*i).toFixed()}%`:`${t} ${i}`:`low ${t}`})).join("\n");class te extends Kt{constructor({x:t,y:e}){super({type:St.ENEMY,x:t,y:e,belongs:Yt.ENEMY}),Object.defineProperty(this,"descriptionText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.descriptionText=x({x:0,y:18,text:"",...Dt,textAlign:"center"}),this.main.addChild(this.descriptionText),this.resetProps()}async onWizardAttack(t,e){let i=Et.getInstance().level;await this.applyDamage(t,ot.UP,!1,t.attackType===Gt.PENETRATE,e*i)}getMainIcon(){return new qt(-8,-29)}deathCallback(){r(tt,this)}resetProps(){let{level:t,moveCount:e}=Et.getInstance();this.health=5+2*t,this.attack=2+1*t,this.shield=0,this.hitRate=.8,this.criticalRate=.1,this.attackDirection=Bt.FRONT,this.hitBackAttack=0;let i=e>0&&e%13==0||e>=130,{buff:a,desc:s}=Vt(ie(t+1,i));this.applyBuff(a),this.descriptionText.text=s,this.refreshText(),this.damageBg.opacity=0}}let ee=-1,ie=(t,e)=>{if(e){let e=[{buff:{attackDirection:Bt.AROUND,health:2*t},desc:'"Whirlstriker"\nRange: around'},{buff:{attackDirection:Bt.LINE,attack:2*t,health:1*t},desc:'"Spearman"\nRange: line'},{buff:{hitBackAttack:3*t,health:2*t},desc:'"Counterstriker"\nHit back: '+3*t},{buff:{shield:4*t},desc:'"Guardian"\nShield: '+4*t},{buff:{attackType:Gt.PENETRATE,attack:2*t},desc:'"Penetrator"\nPenetrate shield'},{buff:{attackDirection:Bt.AROUND,attackType:Gt.PENETRATE,shield:5*t},desc:'"Stormpiercer"\nPenetrate, around'}];return ee<e.length-1?ee++:ee=0,[e[ee]]}return[{shield:2*t,health:-2*t},{health:1*t,attack:Math.floor(-.5*t)},{criticalRate:.05*t,health:-2*t},{attack:1*t,hitRate:-.2}].map((t=>({buff:t,desc:Zt(t)})))};class ae extends d{constructor(t,e){super({x:t,y:e}),this.setScale(.5)}draw(){K(this.context,"7 7 0 7 0 0 2 0 2 5 7 5 7 7",U,11,6),K(this.context,"22 3 15 0 12 0 12 2 13 2 20 5 22 10 22 14 20 19 13 22 11 22 4 19 2 14 2 10 4 5 11 2 12 2 12 0 9 0 2 3 0 8 0 16 2 21 9 24 15 24 22 21 24 16 24 8 22 3",U)}}class se extends d{constructor(t,e){super({x:t,y:e}),this.setScale(.4)}draw(){K(this.context,"24 5 20 5 20 0 12 0 12 5 8 5 0 24 32 24 24 5",U,0,4)}}class re extends d{constructor(t,e){super({x:t,y:e})}draw(){z(this.context,6,0,6,3,U),K(this.context,"12 6 12 0 6 0 6 6 0 11 4 24 14 24 18 11 12 6",U,0,5)}}class ne extends $t{constructor({type:t,x:e,y:i,duration:a,weight:s}){super({type:t,x:e,y:i}),Object.defineProperty(this,"descriptionText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"durationText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"weightText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"buff",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"duration",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"weight",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"level",{enumerable:!0,configurable:!0,writable:!0,value:1}),this.duration=a,this.weight=s,this.buff=this.pickBuff(),this.descriptionText=x({x:0,y:18,text:Jt(this.buff),...Dt,textAlign:"center"}),this.durationText=x({text:`${a}`,x:42,y:40,...Dt}),this.weightText=x({text:`${s}`,x:-24,y:40,...Dt}),this.main.addChild([this.descriptionText,new ae(22,32),this.durationText,new se(-46,32),this.weightText])}getMainIcon(){switch(this.type){case St.WEAPON:return new Wt(-11,-32,1);case St.SHIELD:return new Ut(-10,-31,1,U);case St.POTION:return new re(-9,-36);default:throw new Error(`Invalid card type: ${this.type}`)}}async equip(){this.duration=Math.max(this.duration,2),await Promise.all([V(this.main,{targetY:-24},300,50),this.setChildrenOpacity(0,300)]),this.main.y=0}resetProps(){this.durationText.text=`${this.duration}`,this.weightText.text=`${this.weight}`}updateDuration(t){return this.duration+=t,!(this.duration<=0)&&(this.durationText.text=`${this.duration}`,!0)}upgrade(t){this.level+=t.level,this.level=Math.min(this.level,4),this.duration+=t.duration,this.weight=he(this.type,this.level),this.buff=this.pickBuff(),this.descriptionText.text=Jt(this.buff),this.resetProps()}pickBuff(){let{isKnight:t,isWizard:e,isDefender:i,level:a}=Et.getInstance(),s=a+1;switch(this.type){case St.WEAPON:return oe(this.level,s,t);case St.SHIELD:return ce(this.level,s,i);case St.POTION:return le(this.level,s,e);default:throw new Error(`Invalid card type: ${this.type}`)}}}let he=(t,e)=>{if(t===St.POTION)return 0;let{isWizard:i,isKnight:a}=Et.getInstance(),s=2*(e-1);return t===St.WEAPON?(a?1:3)+s:(i?6:3)+s},oe=(t,e,i)=>{let a=i?e+2*t:1,s=Math.random();if(1===t)return{attack:a};if(2===t)return s<.6?{attack:a,criticalRate:.05}:{attack:a,hitRate:.05};if(3===t)return{attack:a,criticalRate:.1,attackType:Gt.PENETRATE};return{attack:a,attackDirection:s<.5?Bt.AROUND:Bt.LINE,hitBackAttack:3*e}},ce=(t,e,i)=>({shield:Math.floor(e/2+(i?3.5:2)*t)}),le=(t,e,i)=>{let a=Math.random(),s=Math.ceil(t/3),r=.025+.025*t,n=i?.05:.1;return Vt([{health:e*(a>.65-n*t?s:-s)},{criticalRate:e*a>.95-n*t?r:-r},{hitRate:e*a>.95-n*t?r:-r}])};class de extends Kt{constructor({x:t,y:e}){super({type:St.TEMPLAR,x:t,y:e,belongs:Yt.PLAYER}),Object.defineProperty(this,"weight",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"weightText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.resetProps(),this.weightText=x({text:`${this.weight}`,x:-24,y:40,...Dt}),this.main.addChild([new se(-46,32),this.weightText]),s(it,this.updateCls.bind(this))}getMainIcon(){return new Ot({x:-18,y:-24,condition:"b"})}deathCallback(){Et.getInstance().gameOver()}updateCls(t){this.cls=t,this.resetProps()}resetProps(){let{isDefender:t,isKnight:e,isWizard:i}=Et.getInstance();this.health=i?6:10,this.shield=t?10:0,this.attack=e?4:1,this.hitRate=i?.65:.8,this.criticalRate=.1,this.attackDirection=Bt.FRONT,this.attackType=Gt.NORMAL,this.hitBackAttack=t?this.shield:0,t&&this.updateWeight(3),this.refreshText(),r(at,this)}updateWeight(t){this.weight+=t,this.weightText.text=`${this.weight}`;let e=this.weight>=13;this.weightText.color=e?B:U,r(st,e)}}class ue{static createCard(t,e){let{moveCount:i,isDefender:a,isKnight:s}=Et.getInstance();if(i%13==0)return ue.factory({type:St.ENEMY,x:t,y:e});{let r=Math.random()>.5?St.POTION:St.SHIELD,n=[St.ENEMY,a?St.SHIELD:St.WEAPON,r,s?St.WEAPON:St.POTION,a?St.WEAPON:r];return ue.factory({type:n[i%n.length],x:t,y:e})}}static factory(t){let{type:e,x:i,y:a}=t,s=Et.getInstance();switch(e){case St.TEMPLAR:return new de({x:i,y:a});case St.ENEMY:if(s.reusableEnemyCards.length>2){let t=s.reusableEnemyCards.shift();return t.reset(),t.x=i,t.y=a,t}return new te({x:i,y:a});case St.WEAPON:return new ne({...t,duration:4,weight:s.isKnight?3:5});case St.SHIELD:return new ne({...t,duration:6,weight:s.isWizard?6:3});case St.POTION:return new ne({...t,duration:5,weight:0});default:throw new Error(`Invalid card type: ${e}`)}}}class pe extends u{constructor(t,e,i){super({x:t,y:e,width:96,height:28,color:H,anchor:{x:.5,y:.5}}),Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"canvasCallback",{enumerable:!0,configurable:!0,writable:!0,value:null}),this.text=x({text:i,anchor:{x:.5,y:.5},color:U,font:`16px ${At}`}),this.addChild(this.text)}bindClick(t){let e=h();this.canvasCallback=i=>{let{offsetLeft:a,offsetTop:s}=i.target,{world:r}=this,n=r.x-r.width/2,h=r.x+r.width/2,o=r.y-r.height/2,c=r.y+r.height/2,{width:l,height:d}=e,u=Math.min(innerWidth/l,innerHeight/d,devicePixelRatio),p=(i.x-a)/u,f=(i.y-s)/u;p>=n&&p<=h&&f>=o&&f<=c&&t()},e.addEventListener("pointerdown",this.canvasCallback)}offClick(){this.canvasCallback&&h().removeEventListener("pointerdown",this.canvasCallback)}}let{canvas:fe}=function(t,{contextless:a=!1}={}){return e=document.getElementById(t)||t||document.querySelector("canvas"),a&&(e=e||new Proxy({},n)),i=e.getContext("2d")||new Proxy({},n),i.imageSmoothingEnabled=!1,r("init"),{canvas:e,context:i}}();!function(){let t;for(t=0;t<26;t++)O["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)O["Digit"+t]=O["Numpad"+t]=""+t;window.addEventListener("keydown",k),window.addEventListener("keyup",_),window.addEventListener("blur",C)}(),Et.getInstance(),(onresize=function(){let t=fe.getContext("2d"),{width:e,height:i}=fe,a=Math.min(innerWidth/e,innerHeight/i,devicePixelRatio);fe.style.width=fe.width*a+"px",fe.style.height=fe.height*a+"px",t&&(t.imageSmoothingEnabled=!1)})();let we=new class extends d{constructor(t,e){super({x:t,y:e}),Object.defineProperty(this,"classText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"infoText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"overweightText",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let i=p({x:0,y:0,color:M,width:this.context.canvas.width,height:200}),a={text:"",font:`12px ${At}`,color:H};this.classText=x({x:120,y:10,...a}),this.infoText=x({x:120,y:28,...a}),this.overweightText=x({x:56,y:34,anchor:{x:.5,y:.5},...a,color:B}),this.addChild([i,new Ot({x:16,y:62,condition:"i"}),new Lt(120,46),this.classText,this.infoText,this.overweightText]),s(it,this.updateClassText.bind(this)),s(at,this.updateTemplarInfo.bind(this)),s(st,this.updateOverweightText.bind(this))}updateClassText(t){switch(t){case Tt.WIZARD:this.classText.text="Wizard: low attack, low hit rate, equip potion to attack all enemies";break;case Tt.KNIGHT:this.classText.text="Knight: everything is normal but balanced";break;case Tt.DEFENDER:this.classText.text="Defender: low attack, hit back with shield"}}updateTemplarInfo(t){let e=[`Attack: ${t.attackType}`,`Range: ${t.attackDirection}`,`Hit Rate: ${(100*t.hitRate).toFixed()}%`,`Critical Rate: ${(100*t.criticalRate).toFixed()}%`,`Hit Back: ${t.hitBackAttack}`];this.infoText.text=e.join(" | ")}updateOverweightText(t){this.overweightText.text=t?"Overweight!!!":""}}(0,fe.height-200),xe=new class extends d{constructor(t,e){super({x:t,y:e}),Object.defineProperty(this,"grids",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"occupiedInfo",{enumerable:!0,configurable:!0,writable:!0,value:Array.from({length:5},(()=>Array.from({length:5},(()=>null))))}),Object.defineProperty(this,"templarCard",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),s(Z,this.onSwipe.bind(this));let i=p({x:0,y:0,width:532,height:532,color:X});this.addChild(i);for(let s=0;s<5;s++)for(let t=0;t<5;t++){let e=new jt({x:8+104*s+50,y:8+104*t+50,coord:[t,s]});this.grids.push(e),this.addChild(e)}let a=this.getGridByCoord([2,2]);this.templarCard=ue.factory({type:St.TEMPLAR,x:a.x,y:a.y}),this.addChild(this.templarCard),this.occupiedInfo[2][2]=this.templarCard,this.spawnCards(),s(et,this.onRemoveEnemyDead.bind(this))}getGridByCoord(t){let e=this.grids[t[0]+5*t[1]];if(!e)throw new Error(`Grid not found by coord: ${t}`);return e}onRemoveEnemyDead(t){for(let e=0;e<5;e++){let i=!1;for(let a=0;a<5;a++){if(this.occupiedInfo[a][e]===t){this.occupiedInfo[a][e]=null,i=!0;break}}if(i)break}this.removeChild(t)}async onSwipe(t){await this.checkOverweight(),await this.moveCards(t),await this.checkAttack(t),await this.checkDuration(),this.spawnCards(),r(J)}async checkOverweight(){this.templarCard.weight<13||this.templarCard.applyOverweightDamage()}async moveCards(t){let e=Et.getInstance(),i=t===ot.RIGHT,a=t===ot.LEFT,s=t===ot.UP,n=t===ot.DOWN,h=i?3:1,o=n?3:1,c=i?-1:5,l=n?-1:5,d=i?-1:1,u=n?-1:1,p=[];for(let r=s||n?0:h;r!==c;r+=d)for(let t=a||i?0:o;t!==l;t+=u){let e=this.occupiedInfo[t][r];if(!e)continue;let h=r,o=t;for(;;){let t=h+(i?1:a?-1:0),e=o+(n?1:s?-1:0),r=this.occupiedInfo?.[e]?.[t];if(t<0||t>=5||e<0||e>=5||r)break;h=t,o=e}let c=this.getGridByCoord([o,h]);p.push({card:e,x:c.x,y:c.y}),this.occupiedInfo[t][r]=null,this.occupiedInfo[o][h]=e}await Promise.all(p.map((({card:t,x:e,y:i})=>t.moveTo(e,i))));let f=[],w=[];for(let r=s||n?0:h;r!==c;r+=d)for(let t=a||i?0:o;t!==l;t+=u){let h=this.occupiedInfo[t][r];if(!h)continue;let o=r,c=t;for(;;){let t=o+(i?1:a?-1:0),r=c+(n?1:s?-1:0);if(t<0||t>=5||r<0||r>=5)break;let l=this.occupiedInfo?.[r]?.[t];if(l){let i=h.type===St.TEMPLAR&&l instanceof ne,a=h.type===l.type&&h instanceof ne,s=e.isWizard;if(i||a){i&&h.applyBuff(l.buff),a&&h.upgrade(l),a&&ct(...gt(!1)),s&&l.type===St.POTION&&h.type===St.POTION&&w.push(1),await l.equip(),this.occupiedInfo[r][t]=null,h instanceof de&&l.type!==St.POTION?(h.updateWeight(l.weight),f.push(l)):(s&&h.type===St.TEMPLAR&&w.push(l.level),await l.setInactive()),this.removeChild(l);let e=this.getGridByCoord([r,t]);await h.moveTo(e.x,e.y);continue}break}o=t,c=r}let l=this.getGridByCoord([c,o]);await h.moveTo(l.x,l.y),this.occupiedInfo[t][r]=null,h instanceof Kt&&h.health<=0||(this.occupiedInfo[c][o]=h)}if(w.length){let t=this.occupiedInfo.flat().filter((t=>t instanceof te));for(let e of w)r(nt),await Promise.all(t.map((t=>t.onWizardAttack(this.templarCard,e))))}f.length&&e.addItems(f)}spawnCards(){let t=Et.getInstance(),e=t.moveCount%5==1||t.moveCount%5==3;for(let i=0;i<(e?2:1);i++){let t=[];for(let n=0;n<5;n++)for(let e=0;e<5;e++)this.occupiedInfo[e][n]||t.push([e,n]);let e=Math.floor(Math.random()*t.length),[i,a]=t[e],s=this.getGridByCoord([i,a]),r=ue.createCard(s.x,s.y);this.addChild(r),this.occupiedInfo[i][a]=r}}async checkAttack(t){let e=[];for(let i=0;i<5;i++)for(let a=0;a<5;a++){let s=this.occupiedInfo[a][i];if(!(s instanceof Kt))continue;let{attackDirection:r}=s,n=r===Bt.FRONT,h=r===Bt.AROUND,o=r===Bt.LINE;if(n){let r=a+(t===ot.UP?-1:t===ot.DOWN?1:0),n=i+(t===ot.LEFT?-1:t===ot.RIGHT?1:0),h=this.occupiedInfo?.[r]?.[n];if(n<0||n>=5||r<0||r>=5||!h||!(h instanceof Kt)||h.belongs===s.belongs)continue;e.push({attacker:s,target:h,direction:t})}else if(h){let t=[[0,1],[1,0],[0,-1],[-1,0]];for(let[r,n]of t){let t=a+r,h=i+n,o=this.occupiedInfo?.[t]?.[h];if(o instanceof Kt&&o.belongs!==s.belongs){let t=0===r&&1===n?ot.RIGHT:1===r&&0===n?ot.DOWN:0===r&&-1===n?ot.LEFT:ot.UP;e.push({attacker:s,target:o,direction:t})}}}else if(o){let r=t===ot.UP||t===ot.DOWN,n=r?i:a,h=r?a:i;for(let t=0;t<5;t++){if(t===h)continue;let i=r?this.occupiedInfo[t][n]:this.occupiedInfo[n][t];i instanceof Kt&&i.belongs!==s.belongs&&e.push({attacker:s,target:i,direction:t<h&&r?ot.UP:t<h&&!r?ot.LEFT:t>h&&r?ot.DOWN:ot.RIGHT})}}}for(let{attacker:i,target:a,direction:s}of e)await i.execAttack(s,a,!1,i.attackType===Gt.PENETRATE)}async checkDuration(){let t=Et.getInstance(),e=[];for(let a=0;a<5;a++)for(let t=0;t<5;t++){let i=this.occupiedInfo[t][a];if(i instanceof ne){i.updateDuration(-1)||(e.push(i),this.occupiedInfo[t][a]=null)}}let i=[];for(let a of t.currentItems){if(!a.updateDuration(-1)){i.push(a),e.push(a);let t={};Object.entries(a.buff).forEach((([e,i])=>{"attackDirection"===e?t[e]=Bt.FRONT:"attackType"===e?t[e]=Gt.NORMAL:"shield"!==e&&(t[e]=-1*i)})),this.templarCard.applyBuff(t,!1),this.templarCard.updateWeight(-a.weight)}}i.length&&t.removeItems(i),await Promise.all(e.map((t=>t.setInactive())))}}((fe.width-532)/2,84),ye=new class extends w{constructor(t,e){super({text:"MOVE 0",x:t,y:e,color:X,font:"36px Gill Sans",anchor:{x:.5,y:.5}});let i=x({text:"Powerful Enemy Coming!",x:0,y:310,color:N,font:"36px Gill Sans",anchor:{x:.5,y:.5},opacity:0});this.addChild(i),s(Z,(async()=>{let t=Et.getInstance().moveCount;this.text=`MOVE ${t}`,t%13==0||t>=130?(this.color=N,await V(i,{opacity:1},500),await q(800),await V(i,{opacity:0},400)):this.color=X}))}}(fe.width/2,46),ge=new class extends u{constructor(){let{width:t,height:e}=h();super({width:t,height:e,opacity:.8,color:F}),Object.defineProperty(this,"descText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"button",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let i=p({x:t/2,y:e/2,width:280,height:180,anchor:{x:.5,y:.5},color:M}),a=x({text:"Game Over",x:t/2,y:e/2-48,anchor:{x:.5,y:.5},color:H,font:`24px ${At}`});this.descText=x({text:"",x:t/2,y:e/2,anchor:{x:.5,y:.5},textAlign:"center",color:H,font:`16px ${At}`}),this.button=new pe(t/2,e/2+50,"Restart"),this.addChild([i,a,this.descText,this.button,new Ot({x:t/2-32,y:e/2-212,condition:"d"})]),s(rt,this.show.bind(this))}show(){let t=Et.getInstance();this.descText.text=`You did a great job!\nSurvived for ${t.moveCount} moves!`,this.button.bindClick((()=>window.location.reload()))}render(){Et.getInstance().state===vt.GAME_OVER&&super.render()}},be=new class extends u{constructor(){let{width:t,height:e}=h();super({width:t,height:e,opacity:.8,color:F});let i=p({x:t/2,y:e/2,width:360,height:180,anchor:{x:.5,y:.5},color:M}),a=x({text:"Pick a Class",x:t/2,y:e/2-52,anchor:{x:.5,y:.5},color:H,font:`24px ${At}`}),s=x({text:"Pick a class to fight against enemies",x:t/2,y:e/2,anchor:{x:.5,y:.5},color:H,font:`16px ${At}`}),r=Et.getInstance(),n=new pe(t/2-108,e/2+52,"Wizard"),o=new pe(t/2,e/2+52,"Knight"),c=new pe(t/2+108,e/2+52,"Defender"),l=()=>{n.offClick(),o.offClick(),c.offClick()};n.bindClick((()=>{r.setClass(Tt.WIZARD),l()})),o.bindClick((()=>{r.setClass(Tt.KNIGHT),l()})),c.bindClick((()=>{r.setClass(Tt.DEFENDER),l()})),this.addChild([i,a,s,n,o,c])}render(){Et.getInstance().state===vt.INIT&&super.render()}},me=function({fps:e=60,clearCanvas:i=!0,update:a=t,render:n,context:h=o(),blur:c=!1}={}){let l,d,u,p,f,w=0,x=1e3/e,g=1/e,b=i?y:t,m=!0;function v(){if(d=requestAnimationFrame(v),m&&(u=performance.now(),p=u-l,l=u,!(p>1e3))){for(w+=p;w>=x;)r("tick"),f.update(g),w-=x;b(f.context),f.render()}}return c||(window.addEventListener("focus",(()=>{m=!0})),window.addEventListener("blur",(()=>{m=!1}))),s("init",(()=>{f.context??=o()})),f={update:a,render:n,isStopped:!0,context:h,start(){this.isStopped&&(l=performance.now(),this.isStopped=!1,requestAnimationFrame(v))},stop(){this.isStopped=!0,cancelAnimationFrame(d)}},f}({update:()=>{we.update(),xe.update(),ye.update(),ge.update(),be.update()},render:()=>{we.render(),xe.render(),ye.render(),ge.render(),be.render()}});me.start();